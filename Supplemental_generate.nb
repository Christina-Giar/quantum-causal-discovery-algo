(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    210804,       5315]
NotebookOptionsPosition[    207401,       5218]
NotebookOutlinePosition[    207748,       5233]
CellTagsIndexPosition[    207705,       5230]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[TextData[{
 "A Quantum Causal Discovery Algorithm\[LineSeparator]",
 StyleBox["Supplemental material: generation of quantum causal models", 
  "Subtitle"]
}], "Title",
 CellChangeTimes->{{3.699412068280413*^9, 3.699412077739912*^9}, {
   3.6994121230760965`*^9, 3.6994121660231757`*^9}, {3.6994122126686544`*^9, 
   3.6994122391161737`*^9}, 3.699412285003112*^9},
 TextAlignment->Center],

Cell[TextData[{
 "Christina ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["Giarmatzi", 
    RowBox[{"1", ",", "2"}]], TraditionalForm]]],
 " and Fabio ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["Costa", "1"], TraditionalForm]]]
}], "Author",
 CellChangeTimes->{{3.6994122734110126`*^9, 3.6994123123792844`*^9}},
 TextAlignment->Center],

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   SuperscriptBox["", "1"], TraditionalForm]]],
 "Centre for Engineered Quantum Systems, School of Mathematics and Physics, \n\
The University of Queensland, St Lucia, QLD 4072, Australia\n",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["", "2"], TraditionalForm]]],
 "Centre for Quantum Computation and Communication Technology, \nSchool of \
Mathematics and Physics, The University of Queensland, St Lucia, QLD 4072, \
Australia"
}], "Institution",
 CellChangeTimes->{{3.6994123078749475`*^9, 3.6994123199872417`*^9}},
 TextAlignment->Center],

Cell[CellGroupData[{

Cell[TextData[{
 StyleBox["This file contains functions to easily generate Quantum Markov \
Causal Models and export them in a format suitable to be tested with the code \
for causal discovery. To use these function, you first have to evaluate this \
cell group. Expand the cell subgroups for details on the code producing the \
models and the export functions.\n", "Text",
  FontColor->GrayLevel[0]],
 StyleBox["WARNING", "Text",
  FontColor->RGBColor[1, 0, 0]],
 StyleBox[": some functions might crash the kernel if evaluated for too large \
inputs. Make sure you read the instructions before trying new examples.", 
  "Text",
  FontColor->GrayLevel[0]]
}], "Section",
 CellChangeTimes->{
  3.6994128129168854`*^9, {3.69941295986102*^9, 3.6994129996013613`*^9}, {
   3.6994134071529455`*^9, 3.6994134278789816`*^9}, {3.699413748087448*^9, 
   3.699413764796009*^9}, {3.699413898373217*^9, 3.6994138986331215`*^9}, {
   3.699430768453566*^9, 3.699430780126529*^9}, {3.6994766327037*^9, 
   3.6994766386864433`*^9}, {3.69958410721047*^9, 3.699584124945051*^9}, {
   3.699912355230073*^9, 3.699912464403209*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 StyleBox[
  RowBox[{"(*", 
   RowBox[{
   "General", " ", "code", " ", "for", " ", "vector", " ", "and", " ", 
    "tensor", " ", "manipulation"}], " ", "*)"}],
  FontSize->18,
  FontWeight->"Plain"]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10001.},
 CellChangeTimes->{
  3.6991412074857283`*^9, {3.699412680411336*^9, 3.6994126809327593`*^9}, {
   3.699412733658738*^9, 3.6994127350308156`*^9}, {3.6994128552645674`*^9, 
   3.6994128697592554`*^9}, {3.6994130046259546`*^9, 
   3.6994130184649787`*^9}, {3.699413444416418*^9, 3.6994134609575977`*^9}, {
   3.6994140787369614`*^9, 3.69941408330908*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox["\[IndentingNewLine]",
   FontSize->24], 
  RowBox[{"(*", 
   RowBox[{"Projector", " ", "on", " ", "a", " ", "pure", " ", "state"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[CapitalPi]", "[", "\[Psi]_", "]"}], ":=", 
     RowBox[{"KroneckerProduct", "[", 
      RowBox[{"\[Psi]", ",", 
       RowBox[{"\[Psi]", "\[Conjugate]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Pauli", "=", 
     RowBox[{
      RowBox[{"Map", "[", 
       RowBox[{"PauliMatrix", ",", "##"}], "]"}], "&"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bas", "=", 
     RowBox[{
      RowBox[{"KroneckerProduct", "@@", 
       RowBox[{"Pauli", "[", 
        RowBox[{"List", "[", "##", "]"}], "]"}]}], "&"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Minimum", " ", "eigenvalue", " ", "of", " ", "a", " ", "matrix", " ", 
     RowBox[{"M", "--"}], "real", " ", "values", " ", 
     RowBox[{"only", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"min", "[", "M_", "]"}], ":=", 
     RowBox[{"Min", "[", 
      RowBox[{"Re", "[", 
       RowBox[{"Eigenvalues", "[", "M", "]"}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"dimension", " ", "of", " ", "a", " ", "matrix", " ", 
     RowBox[{"M", ".", " ", "For"}], " ", "a", " ", "matrix", " ", "nXm", " ",
      "gives", " ", "the", " ", "minimum", " ", "between", " ", "n", " ", 
     "and", " ", 
     RowBox[{"m", "."}]}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{"dim", "[", "M_", "]"}], ":=", 
    RowBox[{"Min", "[", 
     RowBox[{"Dimensions", "[", "M", "]"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Gives", " ", "a", " ", "positive", " ", "matrix", " ", "with", " ", "a", 
     " ", 
     RowBox[{"(", "almost", ")"}], " ", "null", " ", "eigenvalue", " ", 
     "obtained", " ", "by", " ", "adding", " ", "identity", " ", "to", " ", 
     "M"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"positive", "[", "M_", "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"-", 
       RowBox[{"Floor", "[", 
        RowBox[{
         RowBox[{"min", "[", "M", "]"}], ",", 
         RowBox[{"10", "^", 
          RowBox[{"(", 
           RowBox[{"-", "10"}], ")"}]}]}], "]"}]}], 
      RowBox[{"IdentityMatrix", "[", 
       RowBox[{"dim", "[", "M", "]"}], "]"}]}], "+", "M"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Partial", " ", 
      RowBox[{"trace", "\[IndentingNewLine]", "::", "usage"}]}], "=", 
     "\"\<PartialTrace[p,a,b,sys] gives the partial trace with respect to \
system\n  sys (1 or 2) of a density matrix p with subsystems of dimentions a \
and b.\n  Author: Toby Cubitt\>\""}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PartialTrace", "[", 
     RowBox[{"p_", ",", "a_", ",", "b_", ",", "sys_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "s", "}"}], ",", 
      RowBox[{
       RowBox[{"s", "=", 
        RowBox[{"Partition", "[", 
         RowBox[{"p", ",", 
          RowBox[{"{", 
           RowBox[{"b", ",", "b"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"sys", "\[Equal]", "2"}], ",", 
         RowBox[{"s", "=", 
          RowBox[{"Transpose", "[", 
           RowBox[{"s", ",", 
            RowBox[{"{", 
             RowBox[{"3", ",", "4", ",", "1", ",", "2"}], "}"}]}], "]"}]}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"s", "=", 
        RowBox[{"Tr", "[", 
         RowBox[{"s", ",", "Plus", ",", "2"}], "]"}]}]}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   StyleBox["\[IndentingNewLine]",
    FontSize->16], 
   StyleBox[
    RowBox[{"(*", 
     RowBox[{"Manipulations", " ", "of", " ", "tensor", " ", "products"}], 
     "*)"}],
    FontSize->16], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"recurflat", "[", "m", "]"}], " ", "transforms", " ", "a", " ", 
      "tensor", " ", "product", " ", "between", " ", "m"}], "+", 
     RowBox[{
     "1", " ", "matrices", " ", "in", " ", "their", " ", "Kronecker", " ", 
      RowBox[{"product", ".", " ", "Use"}], " ", "as", " ", 
      RowBox[{
       RowBox[{"recurflat", "[", "m", "]"}], "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          SubscriptBox["A", "1"], "\[CircleTimes]"}], "..."}], 
        "\[CircleTimes]", 
        SubscriptBox["A", "m"]}], "]"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"recurflat", "[", "1", "]"}], "=", 
     RowBox[{
      RowBox[{"ArrayFlatten", "[", "#", "]"}], "&"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"recurflat", "[", "m_", "]"}], "=", 
     RowBox[{
      RowBox[{"ArrayFlatten", "[", 
       RowBox[{
        RowBox[{"recurflat", "[", 
         RowBox[{"m", "-", "1"}], "]"}], "[", "#", "]"}], "]"}], "&"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Transform", " ", "the", " ", "a", " ", "matrix", " ", "mat", " ", 
      "into", " ", "the", " ", "tensor", " ", "product", " ", "of", " ", "a", 
      " ", "set", " ", "of", " ", 
      RowBox[{"matrices", ".", " ", 
       StyleBox["dims",
        FontSlant->"Italic"]}], " ", "is", " ", "the", " ", "list", " ", "of",
       " ", "dimensions", " ", "of", " ", "the", " ", "matrices", " ", 
      "except", " ", "the", " ", 
      RowBox[{"first", ".", " ", "E", ".", "g", "."}]}], ",", " ", 
     RowBox[{"for", " ", 
      RowBox[{"A", "\[TensorProduct]", "B", "\[TensorProduct]", "C"}]}], ",", 
     " ", 
     RowBox[{
      StyleBox["dims",
       FontSlant->"Italic"], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"rows", " ", "of", " ", "B"}], ",", " ", 
          RowBox[{"colums", " ", "of", " ", "B"}], ",", " ", 
          RowBox[{"rows", " ", "of", " ", "C"}], ",", " ", 
          RowBox[{"colums", " ", "of", " ", "C"}]}], "}"}], ".", 
        "\[IndentingNewLine]", "The"}], " ", "function", " ", "effectively", 
       " ", "turns", " ", "a", " ", "Kronecker", " ", "product", " ", "into", 
       " ", "a", " ", "tensor", " ", 
       RowBox[{"product", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tenspart", "[", 
     RowBox[{"mat_", ",", "dims_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"part", ",", "l", ",", "j", ",", "dim"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"l", "=", 
        RowBox[{"Length", "[", "dims", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"part", "[", "0", "]"}], "=", "mat"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dim", "=", "dims"}], ";", "\[IndentingNewLine]", 
       RowBox[{"j", "=", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"l", "\[GreaterEqual]", "2"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"part", "[", "j", "]"}], "=", 
           RowBox[{"Partition", "[", 
            RowBox[{
             RowBox[{"part", "[", 
              RowBox[{"j", "-", "1"}], "]"}], ",", 
             RowBox[{"Take", "[", 
              RowBox[{"dim", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"l", "-", "1"}], ",", "l"}], "}"}]}], "]"}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"j", "++"}], ";", "\[IndentingNewLine]", 
          RowBox[{"dim", "=", 
           RowBox[{"Take", "[", 
            RowBox[{"dim", ",", 
             RowBox[{"l", "-", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"l", "=", 
           RowBox[{"Length", "[", "dim", "]"}]}]}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"part", "[", 
        RowBox[{"j", "-", "1"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Transform", " ", "a", " ", "permutation", " ", "between", " ", "n", " ",
       "elements", " ", "into", " ", "a", " ", "permutation", " ", "between", 
      " ", "2", "n", " ", "elements"}], ",", " ", 
     RowBox[{
     "where", " ", "elements", " ", "are", " ", "permuted", " ", "in", " ", 
      "contiguous", " ", 
      RowBox[{"pairs", ".", " ", "Only"}], " ", "works", " ", "form", " ", 
      "permutation", " ", "input", " ", "as", " ", "a", " ", "list"}]}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"doubleperm", "[", "perm_", "]"}], ":=", 
     RowBox[{"Flatten", "[", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"2", 
            RowBox[{"perm", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], "-", "1"}], ",", 
          RowBox[{"2", 
           RowBox[{"perm", "[", 
            RowBox[{"[", "j", "]"}], "]"}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{"Length", "[", "perm", "]"}]}], "}"}]}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
      "Permute", " ", "a", " ", "tensor", " ", "product", " ", "between", " ",
        "n", " ", 
       RowBox[{"matrices", ".", " ", 
        RowBox[{"Inputs", ":", " ", 
         StyleBox["tens",
          FontSlant->"Italic"]}]}]}], "=", " ", 
      RowBox[{"tensor", " ", "product"}]}], ",", " ", 
     RowBox[{
      StyleBox["perm",
       FontSlant->"Italic"], "=", "permutation"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tensorpermute", "[", 
      RowBox[{"tens_", ",", "perm_"}], "]"}], ":=", 
     RowBox[{"TensorTranspose", "[", 
      RowBox[{"tens", ",", 
       RowBox[{"doubleperm", "[", "perm", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Take", " ", "a", " ", "matrix", " ", 
      StyleBox["mat",
       FontSlant->"Italic"]}], ",", " ", 
     RowBox[{
      RowBox[{"with", " ", "dimensions", " ", "rows"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"r1", "*", "r2", "*"}], "..."}]}], ",", " ", 
     RowBox[{"columns", "=", 
      RowBox[{
       RowBox[{"c1", "*", "c2", "*"}], "..."}]}], ",", " ", 
     RowBox[{
      RowBox[{
      "treat", " ", "it", " ", "as", " ", "a", " ", "Kronecker", " ", 
       "product", " ", "A1", "*", "A2", "*"}], "..."}], ",", " ", 
     RowBox[{
     "and", " ", "permute", " ", "its", " ", "factors", " ", "according", " ",
       "to", " ", 
      RowBox[{
       StyleBox["perm",
        FontSlant->"Italic"], "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"kronpermute", "[", 
     RowBox[{"mat_", ",", "dims_", ",", "perm_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"m", ",", "tens", ",", "permuted", ",", "out"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"numnber", " ", "of", " ", "factors"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"m", "=", 
        RowBox[{"Length", "[", "perm", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "transform", " ", "the", " ", "matrix", " ", "into", " ", "a", " ", 
         "tensor", " ", 
         RowBox[{"product", ".", " ", "I"}], " ", 
         RowBox[{"didn", "'"}], "t", " ", "understand", " ", "why", " ", "I", 
         " ", "have", " ", "to", " ", "take", " ", "it", " ", "2", " ", 
         "levels", " ", 
         RowBox[{"down", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"tens", "=", 
        RowBox[{
         RowBox[{"tenspart", "[", 
          RowBox[{"mat", ",", "dims"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "permute", " ", "the", " ", "factors", " ", "of", " ", "the", " ", 
         "tensor", " ", "product"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"permuted", "=", 
        RowBox[{"tensorpermute", "[", 
         RowBox[{"tens", ",", "perm"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "transform", " ", "back", " ", "into", " ", "a", " ", "matrix", " ", 
         RowBox[{"(", 
          RowBox[{"=", 
           RowBox[{
           "Kronecker", " ", "product", " ", "of", " ", "the", " ", 
            "permuted", " ", "factors"}]}], ")"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"recurflat", "[", 
         RowBox[{"m", "-", "1"}], "]"}], "[", "permuted", "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\n", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
      "Permute", " ", "factors", " ", "in", " ", "a", " ", "Kronecker", " ", 
       "product", " ", "of", " ", "square", " ", 
       RowBox[{"matrices", ".", " ", "The"}], " ", "input", " ", 
       RowBox[{"is", ":", " ", 
        StyleBox["mat",
         FontSlant->"Italic"]}]}], "=", 
      RowBox[{
      "matrix", " ", "whose", " ", "factor", " ", "to", " ", "permute"}]}], 
     ",", " ", 
     RowBox[{
      StyleBox["dims",
       FontSlant->"Italic"], "=", 
      RowBox[{"list", " ", "of", " ", "dimensions", 
       RowBox[{"(", 
        RowBox[{"=", 
         RowBox[{"rows", "=", "colums"}]}], ")"}], " ", "of", " ", "the", " ",
        "factors"}]}], ",", " ", 
     RowBox[{
      StyleBox["perm",
       FontSlant->"Italic"], "=", 
      RowBox[{"permutation", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"squarekronpermute", "[", 
     RowBox[{"mat_", ",", "dims_", ",", "perm_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"rowcol", ",", "m"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"number", " ", "of", " ", "factors"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"m", "=", 
        RowBox[{"Length", "[", "dims", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "list", " ", "of", " ", "dimensions", " ", "of", " ", "rows", " ", 
         "and", " ", "columns", " ", "of", " ", "each", " ", "factor"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"rowcol", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"dims", "[", 
              RowBox[{"[", "j", "]"}], "]"}], ",", 
             RowBox[{"dims", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "m"}], "}"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kronpermute", "[", 
        RowBox[{"mat", ",", "rowcol", ",", "perm"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Trace", " ", "out", " ", "subsystems", " ", 
      StyleBox["subs",
       FontSlant->"Italic"]}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"j1", ",", "j2", ",", 
         RowBox[{"..", "js"}]}], "}"}], " ", "from", " ", "a", " ", 
       RowBox[{"(", "square", ")"}], " ", "density", " ", "matrix", " ", 
       StyleBox["r",
        FontSlant->"Italic"], " ", "with", " ", "dimension", " ", "equal", 
       " ", "to", " ", "the", " ", "product", " ", "of", " ", 
       StyleBox["dim",
        FontSlant->"Italic"]}], " ", "=", " ", 
      RowBox[{"list", " ", "of", " ", "dimensions"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"middletraces", "[", 
     RowBox[{"r_", ",", "dims_", ",", "subs_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"swapped", ",", "perm", ",", "tot", ",", "subtot", ",", "L"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"total", " ", "dimension"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tot", "=", 
        RowBox[{"Times", "@@", "dims"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "dimension", " ", "of", " ", "systems", " ", "to", " ", "be", " ", 
         "traced", " ", "out"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"subtot", "=", 
        RowBox[{"Times", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"dims", "[", 
            RowBox[{"[", 
             RowBox[{"subs", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"Length", "[", "subs", "]"}]}], "}"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Number", " ", "of", " ", "subsystems"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"L", "=", 
        RowBox[{"Length", "[", "dims", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Swap", " ", "1", "st", " ", "and", " ", "j"}], "-", 
         RowBox[{"th", " ", "subsystems"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"perm", "=", 
        RowBox[{"InversePermutation", "[", 
         RowBox[{"Join", "[", 
          RowBox[{"subs", ",", 
           RowBox[{"Delete", "[", 
            RowBox[{
             RowBox[{"Range", "[", "L", "]"}], ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"subs", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "1", ",", 
                 RowBox[{"Length", "[", "subs", "]"}]}], "}"}]}], "]"}]}], 
            "]"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"swapped", "=", 
        RowBox[{"squarekronpermute", "[", 
         RowBox[{"r", ",", " ", "dims", ",", "perm"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Take", " ", "the", " ", "partial", " ", "trace", " ", "of", " ", 
         "the", " ", "first", " ", "subsystem", " ", 
         RowBox[{"(", 
          RowBox[{"in", " ", "the", " ", "swapped", " ", "matrix"}], ")"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"PartialTrace", "[", 
        RowBox[{"swapped", ",", "subtot", ",", 
         RowBox[{"tot", "/", "subtot"}], ",", "1"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Trace", " ", "subsystems", " ", "subs"}], "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"j1", ",", "j2", ",", 
        RowBox[{"..", "js"}]}], "}"}], " ", "replace", " ", "them", " ", 
      "with", " ", "the", " ", "normalised", " ", "identies"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tracesreplace", "[", 
     RowBox[{"r_", ",", "dims_", ",", "subs_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tr", ",", "ide", ",", "perm", ",", "L", ",", "permdim"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Number", " ", "of", " ", "subsystems"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"L", "=", 
        RowBox[{"Length", "[", "dims", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Partial", " ", "trace", " ", "of", " ", "jth", " ", "subsystem"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"tr", "=", 
        RowBox[{"middletraces", "[", 
         RowBox[{"r", ",", "dims", ",", "subs"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Left", "-", 
         RowBox[{"tensor", " ", "by", " ", "normalised", " ", "identity"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"ide", "=", 
        RowBox[{"KroneckerProduct", "@@", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"IdentityMatrix", "[", 
               RowBox[{"dims", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "]"}], "/", 
              RowBox[{"dims", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "subs"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", "tr", "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"list", " ", "of", " ", "dimensions", " ", "for", " ", 
          RowBox[{"ide", "--"}]}], "-", 
         RowBox[{"with", " ", "subsystems", " ", "subs", " ", "first"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"permdim", "=", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"dims", "[", 
           RowBox[{"[", "subs", "]"}], "]"}], ",", 
          RowBox[{"Delete", "[", 
           RowBox[{"dims", ",", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"subs", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", 
                RowBox[{"Length", "[", "subs", "]"}]}], "}"}]}], "]"}]}], 
           "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Permutation", " ", "to", " ", "shift", " ", "the", " ", "first", " ",
          "subsystems", " ", "to", " ", "the", " ", "positions", " ", 
         "subs"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"perm", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"subs", ",", 
          RowBox[{"Delete", "[", 
           RowBox[{
            RowBox[{"Range", "[", "L", "]"}], ",", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"subs", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", 
                RowBox[{"Length", "[", "subs", "]"}]}], "}"}]}], "]"}]}], 
           "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"permute", " ", "the", " ", "tensor", " ", "product"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"squarekronpermute", "[", 
        RowBox[{"ide", ",", " ", "permdim", ",", "perm"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10001.},
 CellChangeTimes->{{3.683944368660065*^9, 3.683944387534567*^9}, {
   3.683944445378834*^9, 3.683944517747185*^9}, {3.683944561373218*^9, 
   3.683944576143387*^9}, {3.6839446231204805`*^9, 3.6839446285546083`*^9}, {
   3.68394744083315*^9, 3.6839475010573063`*^9}, 3.683947569577986*^9, 
   3.6839489157360306`*^9, 3.684017996261355*^9, {3.684707536546895*^9, 
   3.6847075699757357`*^9}, {3.684709975127386*^9, 3.6847099858941226`*^9}, {
   3.6847100253000755`*^9, 3.684710125838214*^9}, {3.684727305578306*^9, 
   3.6847274156844444`*^9}, {3.684793391343851*^9, 3.684793396719543*^9}, {
   3.685398785828278*^9, 3.685398787865085*^9}, {3.6854026486204457`*^9, 
   3.685402650920806*^9}, {3.6872045389219484`*^9, 3.687204556031536*^9}, 
   3.6873069604837413`*^9, {3.6941256029280233`*^9, 3.6941256098313303`*^9}, {
   3.6941256468642473`*^9, 3.69412565201632*^9}, {3.6941266089504147`*^9, 
   3.694126647487664*^9}, {3.694126698308414*^9, 3.69412670715851*^9}, {
   3.6941442564592223`*^9, 3.6941442732266746`*^9}, {3.6941445155570836`*^9, 
   3.6941445859919724`*^9}, {3.6941446185766478`*^9, 3.694144655716861*^9}, {
   3.6942089625415554`*^9, 3.6942089630381455`*^9}, {3.6942089951737957`*^9, 
   3.6942089962293415`*^9}, {3.6942090698298926`*^9, 3.694209102462974*^9}, 
   3.6942091331743517`*^9, {3.6942101290095177`*^9, 3.6942101311035147`*^9}, {
   3.6959585808705215`*^9, 3.6959585816830444`*^9}, {3.697425760160031*^9, 
   3.6974257608455873`*^9}, {3.699141154008708*^9, 3.6991411580081205`*^9}, {
   3.6991412001183405`*^9, 3.6991412074857283`*^9}, {3.69941304837179*^9, 
   3.6994130492597384`*^9}, {3.699413169763553*^9, 3.699413225370615*^9}, 
   3.6994132571687336`*^9, {3.6994134982085285`*^9, 3.699413501922225*^9}, {
   3.6994754812828426`*^9, 3.6994754959075727`*^9}, {3.699475608411277*^9, 
   3.6994757026562386`*^9}, {3.699475793350378*^9, 3.6994757957163467`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell[BoxData[
 StyleBox[
  RowBox[{"(*", 
   RowBox[{
   "Code", " ", "to", " ", "generate", " ", "process", " ", "matrices", " ", 
    "and", " ", "causal", " ", "models"}], "*)"}],
  FontSize->18,
  FontWeight->"Plain"]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.6991414690166464`*^9, 3.6991527211745057`*^9, {3.6994135055518384`*^9, 
   3.699413507167886*^9}, {3.6994135574486685`*^9, 3.6994135735305653`*^9}, {
   3.6994142052716255`*^9, 3.699414212208478*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Code", " ", "to", " ", "generate", " ", "Choi", " ", "representations", 
    " ", "of", " ", "quantum", " ", "channels"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Generate", " ", "an", " ", "nXm", " ", "complex", " ", "matrix", " ", 
    "with", " ", "iid", " ", "normally", " ", "distributed", " ", 
    RowBox[{"entries", " ", "[", "1", "]"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Ginibre", "[", 
     RowBox[{"n_", ",", "m_"}], "]"}], ":=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"RandomVariate", "[", 
        RowBox[{"NormalDistribution", "[", "]"}], "]"}], "+", " ", 
       RowBox[{"\[ImaginaryI]", " ", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{"NormalDistribution", "[", "]"}], "]"}]}]}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", "1", ",", "n"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"l", ",", "1", ",", "m"}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Generate", " ", "an", " ", "nXm", " ", "real", " ", "matrix", " ", 
     "with", " ", "iid", " ", "normally", " ", "distributed", " ", 
     "entries"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"RGinibre", "[", 
     RowBox[{"n_", ",", "m_"}], "]"}], ":=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"RandomVariate", "[", 
       RowBox[{"NormalDistribution", "[", "]"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", "1", ",", "n"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"l", ",", "1", ",", "m"}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Positive", "-", 
      RowBox[{
      "semidefinite", " ", "Choi", " ", "matrix", " ", "of", " ", "a", " ", 
       "channel", " ", "from", " ", 
       StyleBox["di",
        FontSlant->"Italic"], " ", "to", " ", 
       StyleBox["do",
        FontSlant->"Italic"], " ", "dimensions"}]}], ",", " ", 
     RowBox[{
      RowBox[{"Identity", " ", "if", " ", 
       StyleBox["do",
        FontSlant->"Italic"]}], "=", 
      RowBox[{"1.", " ", "Real", " ", 
       RowBox[{"entries", ".", " ", "To"}], " ", "change", " ", "to", " ", 
       "general", " ", "complex", " ", "entries"}]}], ",", " ", 
     RowBox[{"substitute", " ", "\"\<RGinibre\>\"", " ", "with", " ", 
      RowBox[{"\"\<Ginibre\>\"", " ", "[", "2", "]"}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chanpos", "[", 
     RowBox[{"di_", ",", "do_", ",", "k_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "r", ",", "y", ",", "z"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"x", "=", 
        RowBox[{"RGinibre", "[", 
         RowBox[{
          RowBox[{"di", " ", "do"}], ",", "k"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"r", "=", 
        RowBox[{"x", ".", 
         RowBox[{"x", "\[ConjugateTranspose]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"y", "=", 
        RowBox[{"KroneckerProduct", "[", 
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"MatrixFunction", "[", 
            RowBox[{"Sqrt", ",", 
             RowBox[{"PartialTrace", "[", 
              RowBox[{"r", ",", "di", ",", "do", ",", "2"}], "]"}]}], "]"}], 
           "]"}], ",", 
          RowBox[{"IdentityMatrix", "[", "do", "]"}]}], "]"}]}], " ", ";", 
       "\[IndentingNewLine]", 
       RowBox[{"y", ".", "r", ".", "y"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Default", " ", "to", " ", "full"}], "-", 
     RowBox[{
     "rank", " ", "if", " ", "rank", " ", "is", " ", "not", " ", 
      "specified"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"chanpos", "[", 
     RowBox[{"di_", ",", "do_"}], "]"}], ":=", 
    RowBox[{"chanpos", "[", 
     RowBox[{"di", ",", "do", ",", 
      RowBox[{"di", " ", "do"}]}], "]"}]}]}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.699413632360083*^9, 3.699413660233883*^9}, {
  3.6994142052716255`*^9, 3.699414212208478*^9}, {3.699475998493043*^9, 
  3.6994760299335814`*^9}, {3.721196584385668*^9, 3.7211965869218454`*^9}, {
  3.7211966376809387`*^9, 3.7211966442785845`*^9}, {3.7211993932687583`*^9, 
  3.7211994005878687`*^9}, {3.7211994442710514`*^9, 3.7211994575365195`*^9}, {
  3.72119989849743*^9, 3.721199899752887*^9}, {3.721200069957651*^9, 
  3.7212000718483467`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
      "Encoding", " ", "of", " ", "dimensions", " ", "and", " ", "causal", 
       " ", "arrows", " ", 
       RowBox[{"(", "channels", ")"}]}], ":", " ", 
      StyleBox["subdim",
       FontSlant->"Italic"]}], "=", " ", 
     RowBox[{
      RowBox[{"full", " ", "list", " ", "of", " ", 
       RowBox[{"subdimensions", ":", " ", 
        RowBox[{
         StyleBox[
          RowBox[{"{", 
           RowBox[{"in1", ",", 
            RowBox[{"{", 
             RowBox[{"out11", ",", "out12", ",", "..."}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"in2", ",", 
              RowBox[{"{", "...", "}"}]}], "}"}], ",", "..."}], "}"}],
          FontSlant->"Italic"], ".", " ", 
         StyleBox["channels",
          FontSlant->"Italic"]}]}]}], "=", " ", 
      RowBox[{
       RowBox[{"list", " ", "of", " ", "channels", " ", 
        RowBox[{"(", "arrows", ")"}]}], ":", " ", 
       StyleBox[
        RowBox[{"{", 
         RowBox[{"ch1", ",", " ", "ch2", ",", "..."}], "}"}],
        FontSlant->"Italic"]}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"with", " ", 
      StyleBox["chj",
       FontSlant->"Italic"]}], 
     StyleBox["=",
      FontSlant->"Italic"], 
     StyleBox[
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"paj1", ",", "paj2", ",", ".."}], "}"}], ",", "inj"}], "}"}],
      FontSlant->"Italic"]}], ",", " ", 
    RowBox[{
     RowBox[{
      StyleBox["pajk",
       FontSlant->"Italic"], 
      StyleBox["=",
       FontSlant->"Italic"], 
      RowBox[{
       RowBox[{
        StyleBox[
         RowBox[{"{", 
          RowBox[{"out", ",", "outsub"}], "}"}],
         FontSlant->"Italic"], " ", "if", " ", 
        RowBox[{"it", "'"}], "s", " ", "the", " ", 
        StyleBox["outsub",
         FontSlant->"Italic"]}], 
       RowBox[{
        StyleBox["-",
         FontSlant->"Italic"], "th"}], " ", "subsystem", " ", "of", " ", 
       "system", " ", 
       StyleBox["out",
        FontSlant->"Italic"]}]}], ";", " ", 
     RowBox[{
      RowBox[{"can", " ", "also", " ", "input", " ", "as", " ", "just", " ", 
       StyleBox["pajk",
        FontSlant->"Italic"]}], 
      StyleBox["=",
       FontSlant->"Italic"], 
      RowBox[{
       RowBox[{
        StyleBox["out",
         FontSlant->"Italic"], " ", "if", " ", 
        StyleBox["out",
         FontSlant->"Italic"], " ", "has", " ", "only", " ", "1", " ", 
        "output", " ", 
        RowBox[{"subsystem", ".", "\[IndentingNewLine]", "Input"}], " ", 
        "states", " ", "are", " ", "coded", " ", "with", " ", "empty", " ", 
        "parent", " ", 
        RowBox[{"space", ":", " ", 
         StyleBox["ch",
          FontSlant->"Italic"]}]}], "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "}"}], ",", 
            StyleBox["inj",
             FontSlant->"Italic"]}], "}"}], " ", "or", " ", "with", " ", 
          "0"}], ":", " ", 
         StyleBox["ch",
          FontSlant->"Italic"]}], "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "0", "}"}], ",", 
          StyleBox["inj",
           FontSlant->"Italic"]}], "}"}]}]}]}]}]}], "*)"}], 
  "\[IndentingNewLine]", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Position", " ", "in", " ", "the", " ", "full"}], ",", " ", 
    RowBox[{
    "flattened", " ", "list", " ", "of", " ", "dimensions", " ", "of", " ", 
     "output", " ", "subsystem", " ", 
     StyleBox["whichsub",
      FontSlant->"Italic"], " ", "of", " ", "party", " ", 
     RowBox[{
      StyleBox["party",
       FontSlant->"Italic"], ".", " ", 
      StyleBox["subdimlist",
       FontSlant->"Italic"]}], " ", "is", " ", "the", " ", "full", " ", 
     "list", " ", "of", " ", "dimensions", " ", "and", " ", "subdimensions", 
     " ", "of", " ", "output", " ", "spaces"}]}], "*)"}], " ", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"posoutsub", "[", 
     RowBox[{"party_", ",", "whichsub_", ",", "subdimlist_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "numoutsub", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "List", " ", "of", " ", "number", " ", "of", " ", "output", " ", 
        "subsystems", " ", "for", " ", "each", " ", "party"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"numoutsub", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"subdimlist", "[", 
            RowBox[{"[", 
             RowBox[{"j", ",", "2"}], "]"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", 
            RowBox[{"Length", "[", "subdimlist", "]"}]}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{"1", "+", 
           RowBox[{"numoutsub", "[", 
            RowBox[{"[", "j", "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", 
            RowBox[{"party", "-", "1"}]}], "}"}]}], "]"}], "+", "1", "+", 
        "whichsub"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Position", " ", "in", " ", "the", " ", "full"}], ",", " ", 
     RowBox[{
     "flattened", " ", "list", " ", "of", " ", "dimensions", " ", "of", " ", 
      "input", " ", "subsystem", " ", "of", " ", "party", " ", 
      RowBox[{
       StyleBox["party",
        FontSlant->"Italic"], ".", " ", "subdimlist"}], " ", "is", " ", "the",
       " ", "full", " ", "list", " ", "of", " ", "dimensions", " ", "and", 
      " ", "subdimensions", " ", "of", " ", "output", " ", "spaces"}]}], 
    "*)"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"posinput", "[", 
     RowBox[{"party_", ",", "subdimlist_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "numoutsub", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "List", " ", "of", " ", "number", " ", "of", " ", "output", " ", 
        "subsystems", " ", "for", " ", "each", " ", "party"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"numoutsub", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"subdimlist", "[", 
            RowBox[{"[", 
             RowBox[{"j", ",", "2"}], "]"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", 
            RowBox[{"Length", "[", "subdimlist", "]"}]}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{"1", "+", 
           RowBox[{"numoutsub", "[", 
            RowBox[{"[", "j", "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", 
            RowBox[{"party", "-", "1"}]}], "}"}]}], "]"}], "+", "1"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Process", " ", "matrix", " ", 
      RowBox[{"(", "comb", ")"}], " ", "obtained", " ", "from", " ", "the", 
      " ", "product", " ", "of", " ", "the", " ", 
      RowBox[{"Choi", "'"}], "s", " ", "of", " ", "the", " ", "channels", " ",
       "defined", " ", "by", " ", "the", " ", "list", " ", 
      StyleBox["channels",
       FontSlant->"Italic"]}], ",", " ", 
     RowBox[{"with", " ", "dimensions", " ", "given", " ", "by", " ", 
      RowBox[{
       StyleBox["subdim",
        FontSlant->"Italic"], ".", " ", "Not"}], " ", "all", " ", 
      "subsystems", " ", "necessarily", " ", "used", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"depends", " ", "on", " ", 
         StyleBox["channels",
          FontSlant->"Italic"]}], ")"}], "."}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"comb", "[", 
     RowBox[{"subdim_", ",", "channels_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"numchan", ",", "convchann", ",", "chan"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Number", " ", "of", " ", "channels"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"numchan", "=", 
        RowBox[{"Length", "[", "channels", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"convert", " ", "the", " ", "list", " ", 
          StyleBox["channels",
           FontSlant->"Italic"], 
          StyleBox[" ",
           FontSlant->"Italic"], "to", " ", "one", " ", "where", " ", "each", 
          " ", "parent", " ", "subsystem", " ", "is", " ", "a", " ", "two"}], 
         "-", 
         RowBox[{"elements", " ", "list"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"convchann", "=", 
        RowBox[{"Replace", "[", 
         RowBox[{"channels", ",", 
          RowBox[{
           RowBox[{"t_", "/;", 
            RowBox[{
             RowBox[{"Length", "[", "t", "]"}], "\[Equal]", "0"}]}], 
           "\[Rule]", " ", 
           RowBox[{"{", 
            RowBox[{"t", ",", "1"}], "}"}]}], ",", 
          RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"j", "-", 
         RowBox[{"th", " ", "channel"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"chan", "[", "j_", "]"}], ":=", 
        RowBox[{"chanpos", "[", 
         RowBox[{
          RowBox[{"Product", "[", 
           RowBox[{
            RowBox[{"subdim", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"convchann", "[", 
                RowBox[{"[", 
                 RowBox[{"j", ",", "1", ",", "k", ",", "1"}], "]"}], "]"}], 
               ",", "2", ",", 
               RowBox[{"convchann", "[", 
                RowBox[{"[", 
                 RowBox[{"j", ",", "1", ",", "k", ",", "2"}], "]"}], "]"}]}], 
              "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"convchann", "[", 
                RowBox[{"[", 
                 RowBox[{"j", ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"subdim", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"convchann", "[", 
              RowBox[{"[", 
               RowBox[{"j", ",", "2"}], "]"}], "]"}], ",", "1"}], "]"}], 
           "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"process", " ", 
         RowBox[{"matrix", "/", "comb"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"KroneckerProduct", " ", "@@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"chan", "[", "j", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "numchan"}], "}"}]}], "]"}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Build", " ", "a", " ", "process", " ", "matrix", " ", "with", " ", 
      "dimensions", " ", "defined", " ", "by", " ", "the", " ", "list", " ", 
      StyleBox["subdim",
       FontSlant->"Italic"], " ", "and", " ", "channels", " ", "defined", " ",
       "by", " ", 
      RowBox[{
       StyleBox["channels",
        FontSlant->"Italic"], ".", " ", "Initial"}], " ", "states", " ", 
      "are", " ", "added", " ", "to", " ", "unused", " ", "input", " ", 
      "spaces"}], ",", " ", 
     RowBox[{"identities", " ", "added", " ", "to", " ", "unusued", " ", 
      RowBox[{"outputs", ".", " ", "Subsystems"}], " ", "are", " ", "ordered",
       " ", "as", " ", "in", " ", 
      StyleBox["subdim",
       FontSlant->"Italic"]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"causalmodel", "[", 
     RowBox[{"subdim_", ",", "channels_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "unshuf", ",", "numchan", ",", "numpart", ",", "children", ",", 
        "missingch", ",", "morechan", ",", "convchann", ",", "parents", ",", 
        "allparents", ",", "missingpa", ",", "lastdims", ",", "perm", ",", 
        "listdims", ",", "permdims"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Number", " ", "of", " ", "parties", " ", "given", " ", "in", " ", 
        "the", " ", "input"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"numpart", "=", 
        RowBox[{"Length", "[", "subdim", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Number", " ", "of", " ", "channels", " ", "given", " ", "in", " ", 
         "the", " ", "input"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"numchan", "=", 
        RowBox[{"Length", "[", "channels", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"convert", " ", "the", " ", "list", " ", 
          StyleBox["channels",
           FontSlant->"Italic"], 
          StyleBox[" ",
           FontSlant->"Italic"], "to", " ", "one", " ", "where", " ", "each", 
          " ", "parent", " ", "subsystem", " ", "is", " ", "a", " ", "two"}], 
         "-", 
         RowBox[{"elements", " ", "list"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"convchann", "=", 
        RowBox[{"Replace", "[", 
         RowBox[{"channels", ",", 
          RowBox[{
           RowBox[{"t_", "/;", 
            RowBox[{
             RowBox[{"Length", "[", "t", "]"}], "\[Equal]", "0"}]}], 
           "\[Rule]", " ", 
           RowBox[{"{", 
            RowBox[{"t", ",", "1"}], "}"}]}], ",", 
          RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"list", " ", "of", " ", "children", " ", "in", " ", 
         StyleBox["channels",
          FontSlant->"Italic"]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"children", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"convchann", "[", 
           RowBox[{"[", 
            RowBox[{"j", ",", "2"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "numchan"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"missing", " ", "children"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"missingch", "=", 
        RowBox[{"Intersection", "@@", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"DeleteCases", "[", "#", "]"}], "[", 
             RowBox[{"Range", "[", "numpart", "]"}], "]"}], "&"}], ",", 
           "children"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "include", " ", "missing", " ", "children", " ", "in", " ", "the", 
         " ", "list", " ", "of", " ", "channels", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
           "as", " ", "channels", " ", "with", " ", "no", " ", "parents"}], 
           ",", " ", 
           RowBox[{"i", ".", "e", ".", " ", "states"}]}], ")"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"morechan", "=", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", "}"}], ",", 
              RowBox[{"missingch", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", "missingch", "]"}]}], "}"}]}], "]"}], 
          ",", "convchann"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"list", " ", "of", " ", "parents", " ", "in", " ", 
         StyleBox["channels",
          FontSlant->"Italic"]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"parents", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"convchann", "[", 
             RowBox[{"[", 
              RowBox[{"j", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", "numchan"}], "}"}]}], "]"}], ",", 
          "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Full", " ", "list", " ", "of", " ", "parent", " ", "subspaces", " ", 
         "in", " ", 
         StyleBox["subdim",
          FontSlant->"Italic"]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"allparents", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"j", ",", "k"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", "numpart"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"subdim", "[", 
                RowBox[{"[", 
                 RowBox[{"j", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}]}], 
           "]"}], ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"parents", " ", "missing", " ", "in", " ", 
         StyleBox["channels",
          FontSlant->"Italic"]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"missingpa", "=", 
        RowBox[{"Intersection", "@@", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"DeleteCases", "[", "#", "]"}], "[", "allparents", "]"}],
             "&"}], ",", "parents"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "list", " ", "of", " ", "dimensions", " ", "of", " ", "missing", " ",
           "parents"}], " ", "=", " ", 
         RowBox[{
         "total", " ", "dimension", " ", "of", " ", "\"\<last\>\"", " ", 
          RowBox[{"supbsistems", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"lastdims", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"subdim", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"missingpa", "[", 
              RowBox[{"[", 
               RowBox[{"j", ",", "1"}], "]"}], "]"}], ",", "2", ",", 
             RowBox[{"missingpa", "[", 
              RowBox[{"[", 
               RowBox[{"j", ",", "2"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", 
            RowBox[{"Length", "[", "missingpa", "]"}]}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"process", " ", 
          RowBox[{"matrix", "/", "comb"}]}], ",", " ", 
         RowBox[{
         "including", " ", "initial", " ", "states", " ", "for", " ", "all", 
          " ", "missing", " ", "input", " ", "spaces", " ", "and", " ", 
          "identity", " ", "for", " ", "all", " ", "last", " ", "output", " ",
           "spaces"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"unshuf", "=", 
        RowBox[{"KroneckerProduct", "[", 
         RowBox[{
          RowBox[{"comb", "[", 
           RowBox[{"subdim", ",", "morechan"}], "]"}], ",", 
          RowBox[{"IdentityMatrix", "[", 
           RowBox[{"Times", "@@", "lastdims"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "dimensions", " ", "of", " ", "all", " ", 
          "subsystems"}], ",", " ", 
         RowBox[{
         "in", " ", "the", " ", "order", " ", "in", " ", "which", " ", "they",
           " ", "appear", " ", "in", " ", 
          StyleBox["subdim",
           FontSlant->"Italic"]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"listdims", "=", 
        RowBox[{"Flatten", "[", "subdim", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "list", " ", "of", " ", "positions", " ", "of", " ", "each", " ", 
          "subsystem", " ", "appearing", " ", "in", " ", "the", " ", 
          "process", " ", "matrix"}], " ", "\[Equal]", 
         RowBox[{
         "permutation", " ", "to", " ", "apply", " ", "to", " ", "proc", " ", 
          "mat", " ", "to", " ", "bring", " ", "subsystem", " ", "to", " ", 
          "the", " ", "order", " ", "defined", " ", "in", " ", 
          StyleBox["subdim",
           FontSlant->"Italic"]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"perm", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"morechan", "[", 
                   RowBox[{"[", 
                    RowBox[{"j", ",", "1"}], "]"}], "]"}], "===", 
                  RowBox[{"{", "}"}]}], ",", "Nothing", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"posoutsub", "[", 
                    RowBox[{
                    RowBox[{"morechan", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "1", ",", "k", ",", "1"}], "]"}], "]"}],
                     ",", 
                    RowBox[{"morechan", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "1", ",", "k", ",", "2"}], "]"}], "]"}],
                     ",", "subdim"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"k", ",", "1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"morechan", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], 
                  "]"}]}], "]"}], ",", 
               RowBox[{"posinput", "[", 
                RowBox[{
                 RowBox[{"morechan", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "2"}], "]"}], "]"}], ",", "subdim"}], 
                "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", 
               RowBox[{"Length", "[", "morechan", "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"posoutsub", "[", 
              RowBox[{
               RowBox[{"missingpa", "[", 
                RowBox[{"[", 
                 RowBox[{"j", ",", "1"}], "]"}], "]"}], ",", 
               RowBox[{"missingpa", "[", 
                RowBox[{"[", 
                 RowBox[{"j", ",", "2"}], "]"}], "]"}], ",", "subdim"}], 
              "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", 
               RowBox[{"Length", "[", "missingpa", "]"}]}], "}"}]}], "]"}]}], 
          "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Permuted", " ", "list", " ", "of", " ", "subsystem", " ", 
          "dimensions"}], ",", " ", 
         RowBox[{"i", ".", "e", "."}], ",", " ", 
         RowBox[{
         "in", " ", "the", " ", "order", " ", "they", " ", "appear", " ", 
          "in", " ", "the", " ", "unshuffled", " ", "process", " ", 
          "matrix"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"permdims", "=", 
        RowBox[{"Permute", "[", 
         RowBox[{"listdims", ",", 
          RowBox[{"InversePermutation", "[", "perm", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Process", " ", "matrix", " ", "with", " ", "subsystems", " ", 
         "reordered", " ", "as", " ", "given", " ", "in", " ", "the", " ", 
         "original", " ", "list", " ", 
         StyleBox["subdim",
          FontSlant->"Italic"]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"squarekronpermute", "[", 
        RowBox[{"unshuf", ",", "permdims", ",", "perm"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.699141325667903*^9, 3.699141334403448*^9}, 
   3.6991414690166464`*^9, 3.6994136795427427`*^9, 3.6994137134304075`*^9, {
   3.6994161988259735`*^9, 3.699416210432245*^9}, {3.699424654305582*^9, 
   3.699424707655729*^9}, {3.699424750144616*^9, 3.6994247705952125`*^9}, {
   3.6994761323998346`*^9, 3.699476133868408*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"(*", 
    RowBox[{"Random", " ", "causal", " ", "structure"}], "*)"}],
   FontSize->16], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Generate", " ", "a", " ", "random"}], ",", " ", "simple", ",", 
    " ", 
    RowBox[{"directed", " ", "acyclic", " ", "graph", " ", "with", " ", 
     StyleBox["n",
      FontSlant->"Italic"], " ", "vertices", " ", "and", " ", "the", " ", 
     "corresponding", " ", "list", " ", "of", " ", "channels", " ", "and", 
     " ", "subsystem", " ", "dimensions", " ", "to", " ", "be", " ", "used", 
     " ", "to", " ", "generate", " ", "a", " ", "causal", " ", "model", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
        "the", " ", "dimension", " ", "of", " ", "each", " ", "subsystem", 
         " ", "is", " ", "given", " ", "by", " ", "the", " ", "parameter", 
         " ", "dim"}], ",", " ", 
        RowBox[{
         RowBox[{"set", " ", "to", " ", "dim"}], "=", 
         RowBox[{"2", " ", "by", " ", 
          RowBox[{"default", ".", " ", "Sink"}], " ", "nodes", " ", "have", 
          " ", "output", " ", "dimension", " ", "1"}]}]}], ")"}], ".", " ", 
      "The"}], " ", "function", " ", "produces", " ", "a", " ", "graph", " ", 
     RowBox[{"DAG", "[", "tag", "]"}]}], ",", " ", 
    RowBox[{"a", " ", "channel", " ", "list", " ", 
     RowBox[{"channels", "[", "tag", "]"}]}], ",", " ", 
    RowBox[{"and", " ", "a", " ", "list", " ", "of", " ", "dimensions", " ", 
     RowBox[{"subdimensions", "[", "tag", "]"}]}], ",", " ", 
    RowBox[{
    "where", " ", "tag", " ", "is", " ", "any", " ", "chosen", " ", "symbol", 
     " ", "to", " ", "label", " ", "the", " ", "model"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"randomstructure", "[", 
      RowBox[{"n_", ",", "tag_"}], "]"}], ":=", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"dim", "=", "2"}], ",", "G1", ",", "vout", ",", "newvert", 
         ",", "nvert", ",", "parentchans", ",", "parentlist", ",", 
         "channelsbyparent"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Generate", " ", "a", " ", "random"}], ",", " ", "simple", 
         ",", " ", 
         RowBox[{"undirected", " ", "graph"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"G1", "=", 
         RowBox[{"RandomGraph", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"n", ",", 
             RowBox[{"RandomInteger", "[", 
              RowBox[{"{", 
               RowBox[{"1", ",", 
                RowBox[{"Binomial", "[", 
                 RowBox[{"n", ",", "2"}], "]"}]}], "}"}], "]"}]}], "}"}], ",", 
           RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Randomly", " ", "permute", " ", "the", " ", "vertex", " ", "labels",
           " ", "of", " ", "the", " ", "graph", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
            "this", " ", "is", " ", "necessary", " ", "to", " ", "obtain", 
             " ", "a", " ", "DAG", " ", "where", " ", "with", " ", 
             "arbitrary", " ", "partial", " ", "order"}], ")"}], ".", " ", 
           "This"}], " ", "gives", " ", "a", " ", "list", " ", "of", " ", 
          "vertices", " ", "not", " ", "a", " ", 
          RowBox[{"graph", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"newvert", "=", 
         RowBox[{"Permute", "[", 
          RowBox[{
           RowBox[{"VertexList", "[", "G1", "]"}], ",", 
           RowBox[{"RandomPermutation", "[", "n", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Convert", " ", "the", " ", "graph"}], ",", " ", 
          RowBox[{"with", " ", "the", " ", "permuted", " ", "vertices"}], ",",
           " ", 
          RowBox[{"into", " ", "a", " ", 
           RowBox[{"DAG", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"DAG", "[", "tag", "]"}], "=", 
         RowBox[{"DirectedGraph", "[", 
          RowBox[{
           RowBox[{"Graph", "[", 
            RowBox[{"newvert", ",", 
             RowBox[{"EdgeList", "[", "G1", "]"}], ",", 
             RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}], 
           ",", "\"\<Acyclic\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "The", " ", "code", " ", "below", " ", "converts", " ", "the", " ", 
          "DAG", " ", "into", " ", "a", " ", "list", " ", "of", " ", 
          "channels", " ", "to", " ", "be", " ", "used", " ", "to", " ", 
          "generate", " ", "the", " ", "causal", " ", "model"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"vout", "[", "v_", "]"}], ":=", 
         RowBox[{"VertexOutDegree", "[", 
          RowBox[{
           RowBox[{"DAG", "[", "tag", "]"}], ",", "v"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "List", " ", "of", " ", "arrows", " ", "in", " ", "the", " ", 
           "DAG"}], ",", " ", 
          RowBox[{
          "odered", " ", "by", " ", "parent", " ", "node", " ", "and", " ", 
           "by", " ", "outgoing", " ", "arrow", " ", "in", " ", "each", " ", 
           "node"}], ",", " ", 
          RowBox[{
          "in", " ", "the", " ", "form", " ", "to", " ", "be", " ", "used", 
           " ", "to", " ", "define", " ", 
           RowBox[{"channels", ":", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"node", " ", "number"}], ",", 
                RowBox[{"arrow", " ", "number"}]}], "}"}], ",", "child"}], 
             "}"}]}]}]}], "*)"}], " ", "\[IndentingNewLine]", 
        RowBox[{"channelsbyparent", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ReplaceAll", "[", 
               RowBox[{
                RowBox[{"v", "\[DirectedEdge]", "p_"}], "\[Rule]", " ", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"v", ",", "j"}], "}"}], ",", "p"}], "}"}]}], "]"}],
               "[", 
              RowBox[{
               RowBox[{"EdgeList", "[", 
                RowBox[{
                 RowBox[{"DAG", "[", "tag", "]"}], ",", 
                 RowBox[{"v", "\[DirectedEdge]", "_"}]}], " ", "]"}], "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"v", ",", "1", ",", "n"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", 
               RowBox[{"vout", "[", "v", "]"}]}], "}"}]}], "]"}], ",", "1"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "List", " ", "of", " ", "arrows", " ", "ending", " ", "in", " ", 
           "a", " ", "node", " ", "v"}], ",", " ", 
          RowBox[{"in", " ", "the", " ", "form", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                 "node", " ", "number", " ", "of", " ", "first", " ", 
                  "parent"}], ",", " ", 
                 RowBox[{
                 "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
                  "parent"}]}], "}"}], ",", "v"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                 "node", " ", "number", " ", "of", " ", "second", " ", 
                  "parent"}], ",", " ", 
                 RowBox[{
                 "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
                  "parent"}]}], "}"}], ",", "v"}], "}"}], ",", "..."}], 
            "}"}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"parentchans", "[", "v_", "]"}], ":=", 
         RowBox[{"Select", "[", 
          RowBox[{"channelsbyparent", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "v"}], "&"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "channel", " ", "leading", " ", "into", " ", "a", " ", "node", " ", 
          RowBox[{"v", ".", " ", "It"}], " ", "merges", " ", "the", " ", 
          "list", " ", "above", " ", "as", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
              "node", " ", "number", " ", "of", " ", "first", " ", "parent"}],
               ",", " ", 
              RowBox[{
              "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
               "parent"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
              "node", " ", "number", " ", "of", " ", "second", " ", 
               "parent"}], ",", " ", 
              RowBox[{
              "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
               "parent"}]}], "}"}], ",", "...", ",", "v"}], "}"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"parentlist", "[", "v_", "]"}], ":=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"parentchans", "[", "v", "]"}], "]"}], "\[Equal]", "0"}],
            ",", "Nothing", ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"parentchans", "[", "v", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"j", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"parentchans", "[", "v", "]"}], "]"}]}], "}"}]}], 
            "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "list", " ", "of", " ", "channels", " ", "to", " ", "generate", " ", 
          "the", " ", "causal", " ", 
          RowBox[{"model", ".", " ", "Obtained"}], " ", "by", " ", 
          "combining", " ", "the", " ", "list", " ", "of", " ", "arrows", " ",
           "to", " ", "a", " ", "vertex", " ", "above"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"channels", "[", "tag", "]"}], "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"parentchans", "[", "v", "]"}], "]"}], "\[Equal]", 
              "0"}], ",", "Nothing", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"parentlist", "[", "v", "]"}], ",", "v"}], "}"}]}], 
            "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"v", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "List", " ", "of", " ", "dimensions", " ", "of", " ", "all", " ", 
           "subsystems"}], ",", " ", 
          RowBox[{"in", " ", "the", " ", "form", " ", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"input1", ",", 
                RowBox[{"{", 
                 RowBox[{"output11", ",", "output12", ",", "..."}], "}"}]}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"input2", ",", 
                RowBox[{"{", "..", "}"}]}], "}"}], ",", "..."}], "}"}], ".", 
            " ", "Each"}], " ", "subsystem", " ", "has", " ", "dimension", 
           " ", "dim"}], ",", " ", 
          RowBox[{
          "set", " ", "as", " ", "a", " ", "global", " ", "function", " ", 
           "paramter", " ", "at", " ", "the", " ", 
           RowBox[{"beginning", ".", " ", "Sink"}], " ", "nodes", " ", "have",
            " ", "output", " ", "dimension", " ", "1."}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"subdimensions", "[", "tag", "]"}], "=", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"dim", ",", 
              RowBox[{"ConstantArray", "[", 
               RowBox[{"dim", ",", 
                RowBox[{"vout", "[", "v", "]"}]}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"v", ",", "1", ",", "n"}], "}"}]}], "]"}], "/.", 
          RowBox[{
           RowBox[{"{", "}"}], "\[Rule]", " ", 
           RowBox[{"{", "1", "}"}]}]}]}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Same", " ", "function", " ", "as", " ", "above"}], ",", " ", 
     RowBox[{
     "but", " ", "with", " ", "a", " ", "fixed", " ", "number", " ", "of", 
      " ", 
      RowBox[{"edges", ".", " ", "The"}], " ", "variable", " ", 
      StyleBox["edges",
       FontSlant->"Italic"], " ", "must", " ", "be", " ", "less", " ", "or", 
      " ", "equal", " ", "than", " ", 
      RowBox[{"Binomial", "[", 
       RowBox[{"n", ",", "2"}], "]"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"randomstructure", "[", 
     RowBox[{"n_", ",", "tag_", ",", "edges_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"dim", "=", "2"}], ",", "G1", ",", "vout", ",", "newvert", 
        ",", "nvert", ",", "parentchans", ",", "parentlist", ",", 
        "channelsbyparent"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Generate", " ", "a", " ", "random"}], ",", " ", "simple", 
        ",", " ", 
        RowBox[{"undirected", " ", "graph"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"G1", "=", 
        RowBox[{"RandomGraph", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"n", ",", "edges"}], "}"}], ",", 
          RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Randomly", " ", "permute", " ", "the", " ", "vertex", " ", "labels", 
         " ", "of", " ", "the", " ", "graph", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
           "this", " ", "is", " ", "necessary", " ", "to", " ", "obtain", " ",
             "a", " ", "DAG", " ", "where", " ", "with", " ", "arbitrary", 
            " ", "partial", " ", "order"}], ")"}], ".", " ", "This"}], " ", 
         "gives", " ", "a", " ", "list", " ", "of", " ", "vertices", " ", 
         "not", " ", "a", " ", 
         RowBox[{"graph", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"newvert", "=", 
        RowBox[{"Permute", "[", 
         RowBox[{
          RowBox[{"VertexList", "[", "G1", "]"}], ",", 
          RowBox[{"RandomPermutation", "[", "n", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Convert", " ", "the", " ", "graph"}], ",", " ", 
         RowBox[{"with", " ", "the", " ", "permuted", " ", "vertices"}], ",", 
         " ", 
         RowBox[{"into", " ", "a", " ", 
          RowBox[{"DAG", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DAG", "[", "tag", "]"}], "=", 
        RowBox[{"DirectedGraph", "[", 
         RowBox[{
          RowBox[{"Graph", "[", 
           RowBox[{"newvert", ",", 
            RowBox[{"EdgeList", "[", "G1", "]"}], ",", 
            RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}], 
          ",", "\"\<Acyclic\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "The", " ", "code", " ", "below", " ", "converts", " ", "the", " ", 
         "DAG", " ", "into", " ", "a", " ", "list", " ", "of", " ", 
         "channels", " ", "to", " ", "be", " ", "used", " ", "to", " ", 
         "generate", " ", "the", " ", "causal", " ", "model"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"vout", "[", "v_", "]"}], ":=", 
        RowBox[{"VertexOutDegree", "[", 
         RowBox[{
          RowBox[{"DAG", "[", "tag", "]"}], ",", "v"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "arrows", " ", "in", " ", "the", " ", 
          "DAG"}], ",", " ", 
         RowBox[{
         "odered", " ", "by", " ", "parent", " ", "node", " ", "and", " ", 
          "by", " ", "outgoing", " ", "arrow", " ", "in", " ", "each", " ", 
          "node"}], ",", " ", 
         RowBox[{
         "in", " ", "the", " ", "form", " ", "to", " ", "be", " ", "used", 
          " ", "to", " ", "define", " ", 
          RowBox[{"channels", ":", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"node", " ", "number"}], ",", 
               RowBox[{"arrow", " ", "number"}]}], "}"}], ",", "child"}], 
            "}"}]}]}]}], "*)"}], " ", "\[IndentingNewLine]", 
       RowBox[{"channelsbyparent", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ReplaceAll", "[", 
              RowBox[{
               RowBox[{"v", "\[DirectedEdge]", "p_"}], "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"v", ",", "j"}], "}"}], ",", "p"}], "}"}]}], "]"}], 
             "[", 
             RowBox[{
              RowBox[{"EdgeList", "[", 
               RowBox[{
                RowBox[{"DAG", "[", "tag", "]"}], ",", 
                RowBox[{"v", "\[DirectedEdge]", "_"}]}], " ", "]"}], "[", 
              RowBox[{"[", "j", "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"v", ",", "1", ",", "n"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"vout", "[", "v", "]"}]}], "}"}]}], "]"}], ",", "1"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "arrows", " ", "ending", " ", "in", " ", "a",
           " ", "node", " ", "v"}], ",", " ", 
         RowBox[{"in", " ", "the", " ", "form", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                "node", " ", "number", " ", "of", " ", "first", " ", 
                 "parent"}], ",", " ", 
                RowBox[{
                "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
                 "parent"}]}], "}"}], ",", "v"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                "node", " ", "number", " ", "of", " ", "second", " ", 
                 "parent"}], ",", " ", 
                RowBox[{
                "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
                 "parent"}]}], "}"}], ",", "v"}], "}"}], ",", "..."}], 
           "}"}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"parentchans", "[", "v_", "]"}], ":=", 
        RowBox[{"Select", "[", 
         RowBox[{"channelsbyparent", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "v"}], "&"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "channel", " ", "leading", " ", "into", " ", "a", " ", "node", " ", 
         RowBox[{"v", ".", " ", "It"}], " ", "merges", " ", "the", " ", 
         "list", " ", "above", " ", "as", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "node", " ", "number", " ", "of", " ", "first", " ", "parent"}], 
             ",", " ", 
             RowBox[{
             "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
              "parent"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "node", " ", "number", " ", "of", " ", "second", " ", "parent"}],
              ",", " ", 
             RowBox[{
             "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
              "parent"}]}], "}"}], ",", "...", ",", "v"}], "}"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"parentlist", "[", "v_", "]"}], ":=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"parentchans", "[", "v", "]"}], "]"}], "\[Equal]", "0"}], 
          ",", "Nothing", ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"parentchans", "[", "v", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"j", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"parentchans", "[", "v", "]"}], "]"}]}], "}"}]}], 
           "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "list", " ", "of", " ", "channels", " ", "to", " ", "generate", " ", 
         "the", " ", "causal", " ", 
         RowBox[{"model", ".", " ", "Obtained"}], " ", "by", " ", "combining",
          " ", "the", " ", "list", " ", "of", " ", "arrows", " ", "to", " ", 
         "a", " ", "vertex", " ", "above"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"channels", "[", "tag", "]"}], "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"parentchans", "[", "v", "]"}], "]"}], "\[Equal]", 
             "0"}], ",", "Nothing", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"parentlist", "[", "v", "]"}], ",", "v"}], "}"}]}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"v", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "dimensions", " ", "of", " ", "all", " ", 
          "subsystems"}], ",", " ", 
         RowBox[{"in", " ", "the", " ", "form", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"input1", ",", 
               RowBox[{"{", 
                RowBox[{"output11", ",", "output12", ",", "..."}], "}"}]}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"input2", ",", 
               RowBox[{"{", "..", "}"}]}], "}"}], ",", "..."}], "}"}], ".", 
           " ", "Each"}], " ", "subsystem", " ", "has", " ", "dimension", " ",
           "dim"}], ",", " ", 
         RowBox[{
         "set", " ", "as", " ", "a", " ", "global", " ", "function", " ", 
          "paramter", " ", "at", " ", "the", " ", 
          RowBox[{"beginning", ".", " ", "Sink"}], " ", "nodes", " ", "have", 
          " ", "output", " ", "dimension", " ", "1."}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"subdimensions", "[", "tag", "]"}], "=", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"dim", ",", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{"dim", ",", 
               RowBox[{"vout", "[", "v", "]"}]}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"v", ",", "1", ",", "n"}], "}"}]}], "]"}], "/.", 
         RowBox[{
          RowBox[{"{", "}"}], "\[Rule]", " ", 
          RowBox[{"{", "1", "}"}]}]}]}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}]}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.698961092642275*^9, 3.6989611164646473`*^9}, {
   3.6989611650822554`*^9, 3.698961180043342*^9}, {3.698961232835837*^9, 
   3.6989612521124496`*^9}, {3.698961459337742*^9, 3.698961512792555*^9}, {
   3.698961571069578*^9, 3.698961575137726*^9}, {3.698961619723076*^9, 
   3.698961898427306*^9}, {3.698961958072237*^9, 3.6989619735396013`*^9}, {
   3.6989624248909736`*^9, 3.6989625246197014`*^9}, {3.698962555030895*^9, 
   3.698962566849476*^9}, {3.6989652317864947`*^9, 3.6989652667243996`*^9}, {
   3.698965309710882*^9, 3.698965311520378*^9}, {3.698967997456766*^9, 
   3.6989680485765514`*^9}, 3.6991414690166464`*^9, 3.6991552828115473`*^9, {
   3.699155331476697*^9, 3.6991553408906355`*^9}, {3.699155555919317*^9, 
   3.6991555946928487`*^9}, {3.6993994966309814`*^9, 3.699399523301602*^9}, {
   3.699400589288624*^9, 3.699400590888562*^9}, 3.69940127716403*^9, {
   3.699401422706337*^9, 3.6994014246210527`*^9}, {3.699403253824534*^9, 
   3.699403256804664*^9}, {3.6994320504122505`*^9, 3.6994321678820114`*^9}, {
   3.6994322396212053`*^9, 3.6994322434437647`*^9}, 3.699432338633066*^9, {
   3.69943384866441*^9, 3.6994338580714073`*^9}, {3.6994343222277317`*^9, 
   3.6994343323193016`*^9}, {3.699476357854541*^9, 3.6994763690200987`*^9}, {
   3.6994802692850714`*^9, 3.699480270131503*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Generate", " ", "a", " ", "random", " ", "Markov", " ", "quantum", " ", 
     "causal", " ", "model", " ", "with", " ", 
     StyleBox["n",
      FontSlant->"Italic"], " ", "vertices"}], ",", " ", 
    RowBox[{"simple", " ", "arrows"}], ",", " ", 
    RowBox[{
    "dimension", " ", "2", " ", "for", " ", "each", " ", "input", " ", 
     "system", " ", "and", " ", "output", " ", "subsysten"}], ",", " ", 
    RowBox[{"dimension", " ", "1", " ", "for", " ", "output", " ", "of", " ", 
     RowBox[{"sinks", ".", " ", "The"}], " ", "function", " ", "produces", 
     " ", "a", " ", "graph", " ", 
     RowBox[{"DAG", "[", "tag", "]"}]}], ",", " ", 
    RowBox[{"a", " ", "channel", " ", "list", " ", 
     RowBox[{"channels", "[", "tag", "]"}]}], ",", " ", 
    RowBox[{"a", " ", "list", " ", "of", " ", "dimensions", " ", 
     RowBox[{"subdimensions", "[", "tag", "]"}]}], ",", " ", 
    RowBox[{"and", " ", "a", " ", "process", " ", "matrix", " ", 
     RowBox[{"W", "[", "tag", "]"}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"randommodel", "[", 
     RowBox[{"n_", ",", "tag_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"dim", "=", "2"}], ",", "G1", ",", "newvert", ",", "vout", 
        ",", "parentchans", ",", "parentlist", ",", "channelsbyparent"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Generate", " ", "a", " ", "random"}], ",", " ", "simple", 
        ",", " ", 
        RowBox[{"undirected", " ", "graph"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"G1", "=", 
        RowBox[{"RandomGraph", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"n", ",", 
            RowBox[{"RandomInteger", "[", 
             RowBox[{"{", 
              RowBox[{"1", ",", 
               RowBox[{"Binomial", "[", 
                RowBox[{"n", ",", "2"}], "]"}]}], "}"}], "]"}]}], "}"}], ",", 
          RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Randomly", " ", "permute", " ", "the", " ", "vertex", " ", "labels", 
         " ", "of", " ", "the", " ", "graph", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
           "this", " ", "is", " ", "necessary", " ", "to", " ", "obtain", " ",
             "a", " ", "DAG", " ", "where", " ", "with", " ", "arbitrary", 
            " ", "partial", " ", "order"}], ")"}], ".", " ", "This"}], " ", 
         "gives", " ", "a", " ", "list", " ", "of", " ", "vertices", " ", 
         "not", " ", "a", " ", 
         RowBox[{"graph", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"newvert", "=", 
        RowBox[{"Permute", "[", 
         RowBox[{
          RowBox[{"VertexList", "[", "G1", "]"}], ",", 
          RowBox[{"RandomPermutation", "[", "n", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Convert", " ", "the", " ", "graph"}], ",", " ", 
         RowBox[{"with", " ", "the", " ", "permuted", " ", "vertices"}], ",", 
         " ", 
         RowBox[{"into", " ", "a", " ", 
          RowBox[{"DAG", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DAG", "[", "tag", "]"}], "=", 
        RowBox[{"DirectedGraph", "[", 
         RowBox[{
          RowBox[{"Graph", "[", 
           RowBox[{"newvert", ",", 
            RowBox[{"EdgeList", "[", "G1", "]"}], ",", 
            RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}], 
          ",", "\"\<Acyclic\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", 
         RowBox[{
         "The", " ", "code", " ", "below", " ", "converts", " ", "the", " ", 
          "DAG", " ", "into", " ", "a", " ", "list", " ", "of", " ", 
          "channels", " ", "and", " ", "dimensions", " ", "to", " ", "be", 
          " ", "used", " ", "to", " ", "generate", " ", "the", " ", "causal", 
          " ", "model"}], "*)"}],
        FontSlant->"Italic"], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Number", " ", "of", " ", "edges", " ", "outgoing", " ", "from", " ", 
         "vertex", " ", "v"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"vout", "[", "v_", "]"}], ":=", 
        RowBox[{"VertexOutDegree", "[", 
         RowBox[{
          RowBox[{"DAG", "[", "tag", "]"}], ",", "v"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "arrows", " ", "in", " ", "the", " ", 
          "DAG"}], ",", " ", 
         RowBox[{
         "odered", " ", "by", " ", "parent", " ", "node", " ", "and", " ", 
          "by", " ", "outgoing", " ", "arrow", " ", "in", " ", "each", " ", 
          "node"}], ",", " ", 
         RowBox[{
         "in", " ", "the", " ", "form", " ", "to", " ", "be", " ", "used", 
          " ", "to", " ", "define", " ", 
          RowBox[{"channels", ":", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"node", " ", "number"}], ",", 
               RowBox[{"arrow", " ", "number"}]}], "}"}], ",", "child"}], 
            "}"}]}]}]}], "*)"}], " ", "\[IndentingNewLine]", 
       RowBox[{"channelsbyparent", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ReplaceAll", "[", 
              RowBox[{
               RowBox[{"v", "\[DirectedEdge]", "p_"}], "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"v", ",", "j"}], "}"}], ",", "p"}], "}"}]}], "]"}], 
             "[", 
             RowBox[{
              RowBox[{"EdgeList", "[", 
               RowBox[{
                RowBox[{"DAG", "[", "tag", "]"}], ",", 
                RowBox[{"v", "\[DirectedEdge]", "_"}]}], " ", "]"}], "[", 
              RowBox[{"[", "j", "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"v", ",", "1", ",", "n"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"vout", "[", "v", "]"}]}], "}"}]}], "]"}], ",", "1"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "arrows", " ", "ending", " ", "in", " ", "a",
           " ", "node", " ", "v"}], ",", " ", 
         RowBox[{"in", " ", "the", " ", "form", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                "node", " ", "number", " ", "of", " ", "first", " ", 
                 "parent"}], ",", " ", 
                RowBox[{
                "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
                 "parent"}]}], "}"}], ",", "v"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                "node", " ", "number", " ", "of", " ", "second", " ", 
                 "parent"}], ",", " ", 
                RowBox[{
                "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
                 "parent"}]}], "}"}], ",", "v"}], "}"}], ",", "..."}], 
           "}"}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"parentchans", "[", "v_", "]"}], ":=", 
        RowBox[{"Select", "[", 
         RowBox[{"channelsbyparent", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "v"}], "&"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "channel", " ", "leading", " ", "into", " ", "a", " ", "node", " ", 
         RowBox[{"v", ".", " ", "It"}], " ", "merges", " ", "the", " ", 
         "list", " ", "above", " ", "as", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "node", " ", "number", " ", "of", " ", "first", " ", "parent"}], 
             ",", " ", 
             RowBox[{
             "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
              "parent"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "node", " ", "number", " ", "of", " ", "second", " ", "parent"}],
              ",", " ", 
             RowBox[{
             "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
              "parent"}]}], "}"}], ",", "...", ",", "v"}], "}"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"parentlist", "[", "v_", "]"}], ":=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"parentchans", "[", "v", "]"}], "]"}], "\[Equal]", "0"}], 
          ",", "Nothing", ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"parentchans", "[", "v", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"j", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"parentchans", "[", "v", "]"}], "]"}]}], "}"}]}], 
           "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "list", " ", "of", " ", "channels", " ", "to", " ", "generate", " ", 
         "the", " ", "causal", " ", 
         RowBox[{"model", ".", " ", "Obtained"}], " ", "by", " ", "combining",
          " ", "the", " ", "list", " ", "of", " ", "arrows", " ", "to", " ", 
         "a", " ", "vertex", " ", "above"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"channels", "[", "tag", "]"}], "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"parentchans", "[", "v", "]"}], "]"}], "\[Equal]", 
             "0"}], ",", "Nothing", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"parentlist", "[", "v", "]"}], ",", "v"}], "}"}]}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"v", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "dimensions", " ", "of", " ", "all", " ", 
          "subsystems"}], ",", " ", 
         RowBox[{"in", " ", "the", " ", "form", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"input1", ",", 
               RowBox[{"{", 
                RowBox[{"output11", ",", "output12", ",", "..."}], "}"}]}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"input2", ",", 
               RowBox[{"{", "..", "}"}]}], "}"}], ",", "..."}], "}"}], ".", 
           " ", "Each"}], " ", "subsystem", " ", "has", " ", "dimension", " ",
           "dim"}], ",", " ", 
         RowBox[{
         "set", " ", "as", " ", "a", " ", "global", " ", "function", " ", 
          "paramter", " ", "at", " ", "the", " ", 
          RowBox[{"beginning", ".", " ", "Sink"}], " ", "nodes", " ", "have", 
          " ", "output", " ", "dimension", " ", "1."}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"subdimensions", "[", "tag", "]"}], "=", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"dim", ",", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{"dim", ",", 
               RowBox[{"vout", "[", "v", "]"}]}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"v", ",", "1", ",", "n"}], "}"}]}], "]"}], "/.", 
         RowBox[{
          RowBox[{"{", "}"}], "\[Rule]", " ", 
          RowBox[{"{", "1", "}"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "process", " ", "matrix", " ", "of", " ", "the", " ", "causal", " ", 
         "model"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"W", "[", "tag", "]"}], "=", 
        RowBox[{"causalmodel", "[", 
         RowBox[{
          RowBox[{"subdimensions", "[", "tag", "]"}], ",", 
          RowBox[{"channels", "[", "tag", "]"}]}], "]"}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Same", " ", "function", " ", "as", " ", "above"}], ",", " ", 
     RowBox[{
     "but", " ", "with", " ", "a", " ", "fixed", " ", "number", " ", "of", 
      " ", 
      RowBox[{"edges", ".", " ", "The"}], " ", "variable", " ", 
      StyleBox["edges",
       FontSlant->"Italic"], " ", "must", " ", "be", " ", "less", " ", "or", 
      " ", "equal", " ", "than", " ", 
      RowBox[{
       RowBox[{"Binomial", "[", 
        RowBox[{"n", ",", "2"}], "]"}], "."}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"randommodel", "[", 
     RowBox[{"n_", ",", "tag_", ",", "edges_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"dim", "=", "2"}], ",", "G1", ",", "newvert", ",", "vout", 
        ",", "parentchans", ",", "parentlist", ",", "channelsbyparent"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Generate", " ", "a", " ", "random"}], ",", " ", "simple", 
        ",", " ", 
        RowBox[{"undirected", " ", "graph"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"G1", "=", 
        RowBox[{"RandomGraph", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"n", ",", "edges"}], "}"}], ",", 
          RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Randomly", " ", "permute", " ", "the", " ", "vertex", " ", "labels", 
         " ", "of", " ", "the", " ", "graph", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
           "this", " ", "is", " ", "necessary", " ", "to", " ", "obtain", " ",
             "a", " ", "DAG", " ", "where", " ", "with", " ", "arbitrary", 
            " ", "partial", " ", "order"}], ")"}], ".", " ", "This"}], " ", 
         "gives", " ", "a", " ", "list", " ", "of", " ", "vertices", " ", 
         "not", " ", "a", " ", 
         RowBox[{"graph", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"newvert", "=", 
        RowBox[{"Permute", "[", 
         RowBox[{
          RowBox[{"VertexList", "[", "G1", "]"}], ",", 
          RowBox[{"RandomPermutation", "[", "n", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Convert", " ", "the", " ", "graph"}], ",", " ", 
         RowBox[{"with", " ", "the", " ", "permuted", " ", "vertices"}], ",", 
         " ", 
         RowBox[{"into", " ", "a", " ", 
          RowBox[{"DAG", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DAG", "[", "tag", "]"}], "=", 
        RowBox[{"DirectedGraph", "[", 
         RowBox[{
          RowBox[{"Graph", "[", 
           RowBox[{"newvert", ",", 
            RowBox[{"EdgeList", "[", "G1", "]"}], ",", 
            RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}], 
          ",", "\"\<Acyclic\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", 
         RowBox[{
         "The", " ", "code", " ", "below", " ", "converts", " ", "the", " ", 
          "DAG", " ", "into", " ", "a", " ", "list", " ", "of", " ", 
          "channels", " ", "and", " ", "dimensions", " ", "to", " ", "be", 
          " ", "used", " ", "to", " ", "generate", " ", "the", " ", "causal", 
          " ", "model"}], "*)"}],
        FontSlant->"Italic"], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Number", " ", "of", " ", "edges", " ", "outgoing", " ", "from", " ", 
         "vertex", " ", "v"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"vout", "[", "v_", "]"}], ":=", 
        RowBox[{"VertexOutDegree", "[", 
         RowBox[{
          RowBox[{"DAG", "[", "tag", "]"}], ",", "v"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "arrows", " ", "in", " ", "the", " ", 
          "DAG"}], ",", " ", 
         RowBox[{
         "odered", " ", "by", " ", "parent", " ", "node", " ", "and", " ", 
          "by", " ", "outgoing", " ", "arrow", " ", "in", " ", "each", " ", 
          "node"}], ",", " ", 
         RowBox[{
         "in", " ", "the", " ", "form", " ", "to", " ", "be", " ", "used", 
          " ", "to", " ", "define", " ", 
          RowBox[{"channels", ":", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"node", " ", "number"}], ",", 
               RowBox[{"arrow", " ", "number"}]}], "}"}], ",", "child"}], 
            "}"}]}]}]}], "*)"}], " ", "\[IndentingNewLine]", 
       RowBox[{"channelsbyparent", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ReplaceAll", "[", 
              RowBox[{
               RowBox[{"v", "\[DirectedEdge]", "p_"}], "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"v", ",", "j"}], "}"}], ",", "p"}], "}"}]}], "]"}], 
             "[", 
             RowBox[{
              RowBox[{"EdgeList", "[", 
               RowBox[{
                RowBox[{"DAG", "[", "tag", "]"}], ",", 
                RowBox[{"v", "\[DirectedEdge]", "_"}]}], " ", "]"}], "[", 
              RowBox[{"[", "j", "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"v", ",", "1", ",", "n"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"vout", "[", "v", "]"}]}], "}"}]}], "]"}], ",", "1"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "arrows", " ", "ending", " ", "in", " ", "a",
           " ", "node", " ", "v"}], ",", " ", 
         RowBox[{"in", " ", "the", " ", "form", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                "node", " ", "number", " ", "of", " ", "first", " ", 
                 "parent"}], ",", " ", 
                RowBox[{
                "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
                 "parent"}]}], "}"}], ",", "v"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                "node", " ", "number", " ", "of", " ", "second", " ", 
                 "parent"}], ",", " ", 
                RowBox[{
                "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
                 "parent"}]}], "}"}], ",", "v"}], "}"}], ",", "..."}], 
           "}"}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"parentchans", "[", "v_", "]"}], ":=", 
        RowBox[{"Select", "[", 
         RowBox[{"channelsbyparent", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "v"}], "&"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "channel", " ", "leading", " ", "into", " ", "a", " ", "node", " ", 
         RowBox[{"v", ".", " ", "It"}], " ", "merges", " ", "the", " ", 
         "list", " ", "above", " ", "as", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "node", " ", "number", " ", "of", " ", "first", " ", "parent"}], 
             ",", " ", 
             RowBox[{
             "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
              "parent"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "node", " ", "number", " ", "of", " ", "second", " ", "parent"}],
              ",", " ", 
             RowBox[{
             "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
              "parent"}]}], "}"}], ",", "...", ",", "v"}], "}"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"parentlist", "[", "v_", "]"}], ":=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"parentchans", "[", "v", "]"}], "]"}], "\[Equal]", "0"}], 
          ",", "Nothing", ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"parentchans", "[", "v", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"j", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"parentchans", "[", "v", "]"}], "]"}]}], "}"}]}], 
           "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "list", " ", "of", " ", "channels", " ", "to", " ", "generate", " ", 
         "the", " ", "causal", " ", 
         RowBox[{"model", ".", " ", "Obtained"}], " ", "by", " ", "combining",
          " ", "the", " ", "list", " ", "of", " ", "arrows", " ", "to", " ", 
         "a", " ", "vertex", " ", "above"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"channels", "[", "tag", "]"}], "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"parentchans", "[", "v", "]"}], "]"}], "\[Equal]", 
             "0"}], ",", "Nothing", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"parentlist", "[", "v", "]"}], ",", "v"}], "}"}]}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"v", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "dimensions", " ", "of", " ", "all", " ", 
          "subsystems"}], ",", " ", 
         RowBox[{"in", " ", "the", " ", "form", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"input1", ",", 
               RowBox[{"{", 
                RowBox[{"output11", ",", "output12", ",", "..."}], "}"}]}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"input2", ",", 
               RowBox[{"{", "..", "}"}]}], "}"}], ",", "..."}], "}"}], ".", 
           " ", "Each"}], " ", "subsystem", " ", "has", " ", "dimension", " ",
           "dim"}], ",", " ", 
         RowBox[{
         "set", " ", "as", " ", "a", " ", "global", " ", "function", " ", 
          "paramter", " ", "at", " ", "the", " ", 
          RowBox[{"beginning", ".", " ", "Sink"}], " ", "nodes", " ", "have", 
          " ", "output", " ", "dimension", " ", "1."}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"subdimensions", "[", "tag", "]"}], "=", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"dim", ",", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{"dim", ",", 
               RowBox[{"vout", "[", "v", "]"}]}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"v", ",", "1", ",", "n"}], "}"}]}], "]"}], "/.", 
         RowBox[{
          RowBox[{"{", "}"}], "\[Rule]", " ", 
          RowBox[{"{", "1", "}"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "process", " ", "matrix", " ", "of", " ", "the", " ", "causal", " ", 
         "model"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"W", "[", "tag", "]"}], "=", 
        RowBox[{"causalmodel", "[", 
         RowBox[{
          RowBox[{"subdimensions", "[", "tag", "]"}], ",", 
          RowBox[{"channels", "[", "tag", "]"}]}], "]"}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Generate", " ", "a", " ", "Markov", " ", "quantum", " ", "causal", " ", 
      "model", " ", "where", " ", "output", " ", "systems", " ", "and", " ", 
      "subsystems", " ", "can", " ", "have", " ", "dimension", " ", "larger", 
      " ", "than", " ", "1.", " ", "It", " ", "uses", " ", "the", " ", "same",
       " ", "code", " ", "as", " ", 
      RowBox[{"randommodel", "[", 
       RowBox[{"n", ",", "tag"}], "]"}]}], ",", " ", 
     RowBox[{"removing", " ", "one", " ", "randomly", " ", "chosen", " ", 
      RowBox[{"node", ".", " ", "It"}], " ", "only", " ", "generates", " ", 
      "the", " ", "process", " ", "matrix"}], ",", " ", 
     RowBox[{"W", "[", "tag", "]"}], ",", " ", 
     RowBox[{"the", " ", "DAG"}], ",", " ", 
     RowBox[{"DAG", "[", "tag", "]"}], ",", " ", 
     RowBox[{
     "and", " ", "the", " ", "list", " ", "of", " ", "dimensions", " ", 
      RowBox[{"subdimensions", "[", "tag", "]"}], " ", 
      RowBox[{"(", 
       RowBox[{"not", " ", 
        RowBox[{"channels", "[", "tag", "]"}]}], ")"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"openrandommodel", "[", 
     RowBox[{"m_", ",", "tag_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"dim", "=", "2"}], ",", "n", ",", "G1", ",", "newvert", ",", 
        "vout", ",", "parentchans", ",", "parentlist", ",", 
        "channelsbyparent", ",", "DAGtemp", ",", "channelstemp", ",", 
        "subdimensionstemp", ",", "Wtemp", ",", "todelete", ",", "totrace", 
        ",", "dag2", ",", "ver", ",", "ver2"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "We", " ", "use", " ", "the", " ", "previous", " ", "code", " ", 
         "the", " ", "generate", " ", "a", " ", "model", " ", "with", " ", 
         "m"}], "+", 
        RowBox[{"1", " ", "nodes"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", "=", 
        RowBox[{"m", "+", "1"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Generate", " ", "a", " ", "random"}], ",", " ", "simple", 
         ",", " ", 
         RowBox[{"undirected", " ", "graph"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"G1", "=", 
        RowBox[{"RandomGraph", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"n", ",", 
            RowBox[{"RandomInteger", "[", 
             RowBox[{"{", 
              RowBox[{"1", ",", 
               RowBox[{"Binomial", "[", 
                RowBox[{"n", ",", "2"}], "]"}]}], "}"}], "]"}]}], "}"}], ",", 
          RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Randomly", " ", "permute", " ", "the", " ", "vertex", " ", "labels", 
         " ", "of", " ", "the", " ", "graph", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
           "this", " ", "is", " ", "necessary", " ", "to", " ", "obtain", " ",
             "a", " ", "DAG", " ", "where", " ", "with", " ", "arbitrary", 
            " ", "partial", " ", "order"}], ")"}], ".", " ", "This"}], " ", 
         "gives", " ", "a", " ", "list", " ", "of", " ", "vertices", " ", 
         "not", " ", "a", " ", 
         RowBox[{"graph", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"newvert", "=", 
        RowBox[{"Permute", "[", 
         RowBox[{
          RowBox[{"VertexList", "[", "G1", "]"}], ",", 
          RowBox[{"RandomPermutation", "[", "n", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Convert", " ", "the", " ", "graph"}], ",", " ", 
         RowBox[{"with", " ", "the", " ", "permuted", " ", "vertices"}], ",", 
         " ", 
         RowBox[{"into", " ", "a", " ", 
          RowBox[{"DAG", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"DAGtemp", "=", 
        RowBox[{"DirectedGraph", "[", 
         RowBox[{
          RowBox[{"Graph", "[", 
           RowBox[{"newvert", ",", 
            RowBox[{"EdgeList", "[", "G1", "]"}], ",", 
            RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}], 
          ",", "\"\<Acyclic\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", 
         RowBox[{
         "The", " ", "code", " ", "below", " ", "converts", " ", "the", " ", 
          "DAG", " ", "into", " ", "a", " ", "list", " ", "of", " ", 
          "channels", " ", "and", " ", "dimensions", " ", "to", " ", "be", 
          " ", "used", " ", "to", " ", "generate", " ", "the", " ", "causal", 
          " ", "model"}], "*)"}],
        FontSlant->"Italic"], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Number", " ", "of", " ", "edges", " ", "outgoing", " ", "from", " ", 
         "vertex", " ", "v"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"vout", "[", "v_", "]"}], ":=", 
        RowBox[{"VertexOutDegree", "[", 
         RowBox[{"DAGtemp", ",", "v"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "arrows", " ", "in", " ", "the", " ", 
          "DAG"}], ",", " ", 
         RowBox[{
         "odered", " ", "by", " ", "parent", " ", "node", " ", "and", " ", 
          "by", " ", "outgoing", " ", "arrow", " ", "in", " ", "each", " ", 
          "node"}], ",", " ", 
         RowBox[{
         "in", " ", "the", " ", "form", " ", "to", " ", "be", " ", "used", 
          " ", "to", " ", "define", " ", 
          RowBox[{"channels", ":", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"node", " ", "number"}], ",", 
               RowBox[{"arrow", " ", "number"}]}], "}"}], ",", "child"}], 
            "}"}]}]}]}], "*)"}], " ", "\[IndentingNewLine]", 
       RowBox[{"channelsbyparent", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ReplaceAll", "[", 
              RowBox[{
               RowBox[{"v", "\[DirectedEdge]", "p_"}], "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"v", ",", "j"}], "}"}], ",", "p"}], "}"}]}], "]"}], 
             "[", 
             RowBox[{
              RowBox[{"EdgeList", "[", 
               RowBox[{"DAGtemp", ",", 
                RowBox[{"v", "\[DirectedEdge]", "_"}]}], " ", "]"}], "[", 
              RowBox[{"[", "j", "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"v", ",", "1", ",", "n"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"vout", "[", "v", "]"}]}], "}"}]}], "]"}], ",", "1"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "arrows", " ", "ending", " ", "in", " ", "a",
           " ", "node", " ", "v"}], ",", " ", 
         RowBox[{"in", " ", "the", " ", "form", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                "node", " ", "number", " ", "of", " ", "first", " ", 
                 "parent"}], ",", " ", 
                RowBox[{
                "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
                 "parent"}]}], "}"}], ",", "v"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                "node", " ", "number", " ", "of", " ", "second", " ", 
                 "parent"}], ",", " ", 
                RowBox[{
                "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
                 "parent"}]}], "}"}], ",", "v"}], "}"}], ",", "..."}], 
           "}"}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"parentchans", "[", "v_", "]"}], ":=", 
        RowBox[{"Select", "[", 
         RowBox[{"channelsbyparent", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "v"}], "&"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "channel", " ", "leading", " ", "into", " ", "a", " ", "node", " ", 
         RowBox[{"v", ".", " ", "It"}], " ", "merges", " ", "the", " ", 
         "list", " ", "above", " ", "as", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "node", " ", "number", " ", "of", " ", "first", " ", "parent"}], 
             ",", " ", 
             RowBox[{
             "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
              "parent"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "node", " ", "number", " ", "of", " ", "second", " ", "parent"}],
              ",", " ", 
             RowBox[{
             "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
              "parent"}]}], "}"}], ",", "...", ",", "v"}], "}"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"parentlist", "[", "v_", "]"}], ":=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"parentchans", "[", "v", "]"}], "]"}], "\[Equal]", "0"}], 
          ",", "Nothing", ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"parentchans", "[", "v", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"j", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"parentchans", "[", "v", "]"}], "]"}]}], "}"}]}], 
           "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "list", " ", "of", " ", "channels", " ", "to", " ", "generate", " ", 
         "the", " ", "causal", " ", 
         RowBox[{"model", ".", " ", "Obtained"}], " ", "by", " ", "combining",
          " ", "the", " ", "list", " ", "of", " ", "arrows", " ", "to", " ", 
         "a", " ", "vertex", " ", 
         RowBox[{"above", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"channelstemp", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"parentchans", "[", "v", "]"}], "]"}], "\[Equal]", 
             "0"}], ",", "Nothing", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"parentlist", "[", "v", "]"}], ",", "v"}], "}"}]}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"v", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "dimensions", " ", "of", " ", "all", " ", 
          "subsystems"}], ",", " ", 
         RowBox[{"in", " ", "the", " ", "form", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"input1", ",", 
               RowBox[{"{", 
                RowBox[{"output11", ",", "output12", ",", "..."}], "}"}]}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"input2", ",", 
               RowBox[{"{", "..", "}"}]}], "}"}], ",", "..."}], "}"}], ".", 
           " ", "Each"}], " ", "subsystem", " ", "has", " ", "dimension", " ",
           "dim"}], ",", " ", 
         RowBox[{
         "set", " ", "as", " ", "a", " ", "global", " ", "function", " ", 
          "paramter", " ", "at", " ", "the", " ", 
          RowBox[{"beginning", ".", " ", "Sink"}], " ", "nodes", " ", "have", 
          " ", "output", " ", "dimension", " ", "1."}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"subdimensionstemp", "=", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"dim", ",", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{"dim", ",", 
               RowBox[{"vout", "[", "v", "]"}]}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"v", ",", "1", ",", "n"}], "}"}]}], "]"}], "/.", 
         RowBox[{
          RowBox[{"{", "}"}], "\[Rule]", " ", 
          RowBox[{"{", "1", "}"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "process", " ", "matrix", " ", "of", " ", "the", " ", "causal", " ", 
         "model", " ", "associated", " ", "to", " ", "DAGtemp"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Wtemp", "=", 
        RowBox[{"causalmodel", "[", 
         RowBox[{"subdimensionstemp", ",", "channelstemp"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "choose", " ", "a", " ", "random", " ", "node", " ", "to", " ", 
         "delete"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"todelete", "=", " ", 
        RowBox[{"RandomInteger", "[", 
         RowBox[{"{", 
          RowBox[{"1", ",", "n"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Positions", " ", "of", " ", "the", " ", "subsystems", " ", "to", " ",
          "trace", " ", "out", " ", "in", " ", "the", " ", "flattened", " ", 
         "list", " ", "of", " ", "subsystems", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"including", " ", "output", " ", "subsystems"}], ")"}], 
          "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"totrace", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"posinput", "[", 
            RowBox[{"todelete", ",", "subdimensionstemp"}], "]"}], ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"posoutsub", "[", 
              RowBox[{"todelete", ",", "whichsub", ",", "subdimensionstemp"}],
               "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"whichsub", ",", "1", ",", 
               RowBox[{"vout", "[", "todelete", "]"}]}], "}"}]}], "]"}]}], 
          "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Trace", " ", "out", " ", "chosen", " ", "vertex", " ", "from", " ", 
         "process", " ", "matrix", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
           "both", " ", "input", " ", "and", " ", "output", " ", "spaces"}], 
           ")"}], ".", " ", "Renormalise"}], " ", "as", " ", "a", " ", 
         "process", " ", 
         RowBox[{"matrix", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"W", "[", "tag", "]"}], "=", 
        RowBox[{
         RowBox[{"middletraces", "[", 
          RowBox[{"Wtemp", ",", 
           RowBox[{"Flatten", "[", "subdimensionstemp", "]"}], ",", 
           "totrace"}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"dim", "^", 
           RowBox[{"vout", "[", "todelete", "]"}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"DAG", " ", "with", " ", "deleted", " ", 
          RowBox[{"node", "--"}]}], "-", 
         RowBox[{"also", " ", "relabel", " ", 
          RowBox[{"vertices", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"dag2", "=", 
        RowBox[{"VertexDelete", "[", 
         RowBox[{"DAGtemp", ",", "todelete"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ver", "=", 
        RowBox[{"VertexList", "[", "dag2", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ver2", "=", 
        RowBox[{"Replace", "[", 
         RowBox[{"ver", ",", 
          RowBox[{
           RowBox[{"p_", "/;", 
            RowBox[{"p", ">", "todelete"}]}], "\[Rule]", " ", 
           RowBox[{"p", "-", "1"}]}], ",", 
          RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DAG", "[", "tag", "]"}], "=", 
        RowBox[{"Graph", "[", 
         RowBox[{"ver", ",", 
          RowBox[{"EdgeList", "[", "dag2", "]"}], ",", 
          RowBox[{"VertexLabels", "\[Rule]", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ver", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "\[Rule]", " ", 
              RowBox[{"ver2", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", 
               RowBox[{"Length", "[", "ver", "]"}]}], "}"}]}], "]"}]}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "List", " ", "of", " ", "dimensions", " ", "after", " ", "deleting", 
         " ", "the", " ", "node"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"subdimensions", "[", "tag", "]"}], "=", 
        RowBox[{"Delete", "[", 
         RowBox[{"subdimensionstemp", ",", "todelete"}], "]"}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Same", " ", "function", " ", "as", " ", "above"}], ",", " ", 
     RowBox[{
     "but", " ", "with", " ", "a", " ", "limited", " ", "number", " ", "of", 
      " ", 
      RowBox[{"edges", ".", " ", "The"}], " ", "variable", " ", 
      StyleBox["edges",
       FontSlant->"Italic"], " ", "must", " ", "be", " ", "less", " ", "or", 
      " ", "equal", " ", "than", " ", 
      RowBox[{"Binomial", "[", 
       RowBox[{
        RowBox[{"n", "+", "1"}], ",", "2"}], "]"}], " ", "and", " ", 
      "defines", " ", "the", " ", "number", " ", "of", " ", "edges", " ", 
      "in", " ", "the", " ", "original", " ", "model"}], ",", " ", 
     RowBox[{
     "before", " ", "a", " ", "random", " ", "node", " ", "is", " ", "traced",
       " ", 
      RowBox[{"out", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"openrandommodel", "[", 
     RowBox[{"m_", ",", "tag_", ",", "edges_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"dim", "=", "2"}], ",", "n", ",", "G1", ",", "newvert", ",", 
        "vout", ",", "parentchans", ",", "parentlist", ",", 
        "channelsbyparent", ",", "DAGtemp", ",", "channelstemp", ",", 
        "subdimensionstemp", ",", "Wtemp", ",", "todelete", ",", "totrace", 
        ",", "dag2", ",", "ver", ",", "ver2"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "We", " ", "use", " ", "the", " ", "previous", " ", "code", " ", 
         "the", " ", "generate", " ", "a", " ", "model", " ", "with", " ", 
         "m"}], "+", 
        RowBox[{"1", " ", "nodes"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", "=", 
        RowBox[{"m", "+", "1"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Generate", " ", "a", " ", "random"}], ",", " ", "simple", 
         ",", " ", 
         RowBox[{"undirected", " ", "graph"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"G1", "=", 
        RowBox[{"RandomGraph", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"n", ",", "edges"}], "}"}], ",", 
          RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Randomly", " ", "permute", " ", "the", " ", "vertex", " ", "labels", 
         " ", "of", " ", "the", " ", "graph", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
           "this", " ", "is", " ", "necessary", " ", "to", " ", "obtain", " ",
             "a", " ", "DAG", " ", "where", " ", "with", " ", "arbitrary", 
            " ", "partial", " ", "order"}], ")"}], ".", " ", "This"}], " ", 
         "gives", " ", "a", " ", "list", " ", "of", " ", "vertices", " ", 
         "not", " ", "a", " ", 
         RowBox[{"graph", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"newvert", "=", 
        RowBox[{"Permute", "[", 
         RowBox[{
          RowBox[{"VertexList", "[", "G1", "]"}], ",", 
          RowBox[{"RandomPermutation", "[", "n", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Convert", " ", "the", " ", "graph"}], ",", " ", 
         RowBox[{"with", " ", "the", " ", "permuted", " ", "vertices"}], ",", 
         " ", 
         RowBox[{"into", " ", "a", " ", 
          RowBox[{"DAG", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"DAGtemp", "=", 
        RowBox[{"DirectedGraph", "[", 
         RowBox[{
          RowBox[{"Graph", "[", 
           RowBox[{"newvert", ",", 
            RowBox[{"EdgeList", "[", "G1", "]"}], ",", 
            RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}], 
          ",", "\"\<Acyclic\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", 
         RowBox[{
         "The", " ", "code", " ", "below", " ", "converts", " ", "the", " ", 
          "DAG", " ", "into", " ", "a", " ", "list", " ", "of", " ", 
          "channels", " ", "and", " ", "dimensions", " ", "to", " ", "be", 
          " ", "used", " ", "to", " ", "generate", " ", "the", " ", "causal", 
          " ", "model"}], "*)"}],
        FontSlant->"Italic"], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Number", " ", "of", " ", "edges", " ", "outgoing", " ", "from", " ", 
         "vertex", " ", "v"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"vout", "[", "v_", "]"}], ":=", 
        RowBox[{"VertexOutDegree", "[", 
         RowBox[{"DAGtemp", ",", "v"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "arrows", " ", "in", " ", "the", " ", 
          "DAG"}], ",", " ", 
         RowBox[{
         "odered", " ", "by", " ", "parent", " ", "node", " ", "and", " ", 
          "by", " ", "outgoing", " ", "arrow", " ", "in", " ", "each", " ", 
          "node"}], ",", " ", 
         RowBox[{
         "in", " ", "the", " ", "form", " ", "to", " ", "be", " ", "used", 
          " ", "to", " ", "define", " ", 
          RowBox[{"channels", ":", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"node", " ", "number"}], ",", 
               RowBox[{"arrow", " ", "number"}]}], "}"}], ",", "child"}], 
            "}"}]}]}]}], "*)"}], " ", "\[IndentingNewLine]", 
       RowBox[{"channelsbyparent", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ReplaceAll", "[", 
              RowBox[{
               RowBox[{"v", "\[DirectedEdge]", "p_"}], "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"v", ",", "j"}], "}"}], ",", "p"}], "}"}]}], "]"}], 
             "[", 
             RowBox[{
              RowBox[{"EdgeList", "[", 
               RowBox[{"DAGtemp", ",", 
                RowBox[{"v", "\[DirectedEdge]", "_"}]}], " ", "]"}], "[", 
              RowBox[{"[", "j", "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"v", ",", "1", ",", "n"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"vout", "[", "v", "]"}]}], "}"}]}], "]"}], ",", "1"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "arrows", " ", "ending", " ", "in", " ", "a",
           " ", "node", " ", "v"}], ",", " ", 
         RowBox[{"in", " ", "the", " ", "form", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                "node", " ", "number", " ", "of", " ", "first", " ", 
                 "parent"}], ",", " ", 
                RowBox[{
                "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
                 "parent"}]}], "}"}], ",", "v"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                "node", " ", "number", " ", "of", " ", "second", " ", 
                 "parent"}], ",", " ", 
                RowBox[{
                "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
                 "parent"}]}], "}"}], ",", "v"}], "}"}], ",", "..."}], 
           "}"}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"parentchans", "[", "v_", "]"}], ":=", 
        RowBox[{"Select", "[", 
         RowBox[{"channelsbyparent", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "v"}], "&"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "channel", " ", "leading", " ", "into", " ", "a", " ", "node", " ", 
         RowBox[{"v", ".", " ", "It"}], " ", "merges", " ", "the", " ", 
         "list", " ", "above", " ", "as", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "node", " ", "number", " ", "of", " ", "first", " ", "parent"}], 
             ",", " ", 
             RowBox[{
             "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
              "parent"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "node", " ", "number", " ", "of", " ", "second", " ", "parent"}],
              ",", " ", 
             RowBox[{
             "arrow", " ", "number", " ", "outgoing", " ", "from", " ", 
              "parent"}]}], "}"}], ",", "...", ",", "v"}], "}"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"parentlist", "[", "v_", "]"}], ":=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"parentchans", "[", "v", "]"}], "]"}], "\[Equal]", "0"}], 
          ",", "Nothing", ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"parentchans", "[", "v", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"j", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"parentchans", "[", "v", "]"}], "]"}]}], "}"}]}], 
           "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "list", " ", "of", " ", "channels", " ", "to", " ", "generate", " ", 
         "the", " ", "causal", " ", 
         RowBox[{"model", ".", " ", "Obtained"}], " ", "by", " ", "combining",
          " ", "the", " ", "list", " ", "of", " ", "arrows", " ", "to", " ", 
         "a", " ", "vertex", " ", 
         RowBox[{"above", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"channelstemp", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"parentchans", "[", "v", "]"}], "]"}], "\[Equal]", 
             "0"}], ",", "Nothing", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"parentlist", "[", "v", "]"}], ",", "v"}], "}"}]}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"v", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "List", " ", "of", " ", "dimensions", " ", "of", " ", "all", " ", 
          "subsystems"}], ",", " ", 
         RowBox[{"in", " ", "the", " ", "form", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"input1", ",", 
               RowBox[{"{", 
                RowBox[{"output11", ",", "output12", ",", "..."}], "}"}]}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"input2", ",", 
               RowBox[{"{", "..", "}"}]}], "}"}], ",", "..."}], "}"}], ".", 
           " ", "Each"}], " ", "subsystem", " ", "has", " ", "dimension", " ",
           "dim"}], ",", " ", 
         RowBox[{
         "set", " ", "as", " ", "a", " ", "global", " ", "function", " ", 
          "paramter", " ", "at", " ", "the", " ", 
          RowBox[{"beginning", ".", " ", "Sink"}], " ", "nodes", " ", "have", 
          " ", "output", " ", "dimension", " ", "1."}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"subdimensionstemp", "=", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"dim", ",", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{"dim", ",", 
               RowBox[{"vout", "[", "v", "]"}]}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"v", ",", "1", ",", "n"}], "}"}]}], "]"}], "/.", 
         RowBox[{
          RowBox[{"{", "}"}], "\[Rule]", " ", 
          RowBox[{"{", "1", "}"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "process", " ", "matrix", " ", "of", " ", "the", " ", "causal", " ", 
         "model", " ", "associated", " ", "to", " ", "DAGtemp"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Wtemp", "=", 
        RowBox[{"causalmodel", "[", 
         RowBox[{"subdimensionstemp", ",", "channelstemp"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "choose", " ", "a", " ", "random", " ", "node", " ", "to", " ", 
         "delete"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"todelete", "=", " ", 
        RowBox[{"RandomInteger", "[", 
         RowBox[{"{", 
          RowBox[{"1", ",", "n"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Positions", " ", "of", " ", "the", " ", "subsystems", " ", "to", " ",
          "trace", " ", "out", " ", "in", " ", "the", " ", "flattened", " ", 
         "list", " ", "of", " ", "subsystems", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"including", " ", "output", " ", "subsystems"}], ")"}], 
          "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"totrace", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"posinput", "[", 
            RowBox[{"todelete", ",", "subdimensionstemp"}], "]"}], ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"posoutsub", "[", 
              RowBox[{"todelete", ",", "whichsub", ",", "subdimensionstemp"}],
               "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"whichsub", ",", "1", ",", 
               RowBox[{"vout", "[", "todelete", "]"}]}], "}"}]}], "]"}]}], 
          "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Trace", " ", "out", " ", "chosen", " ", "vertex", " ", "from", " ", 
         "process", " ", "matrix", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
           "both", " ", "input", " ", "and", " ", "output", " ", "spaces"}], 
           ")"}], ".", " ", "Renormalise"}], " ", "as", " ", "a", " ", 
         "process", " ", 
         RowBox[{"matrix", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"W", "[", "tag", "]"}], "=", 
        RowBox[{
         RowBox[{"middletraces", "[", 
          RowBox[{"Wtemp", ",", 
           RowBox[{"Flatten", "[", "subdimensionstemp", "]"}], ",", 
           "totrace"}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"dim", "^", 
           RowBox[{"vout", "[", "todelete", "]"}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"DAG", " ", "with", " ", "deleted", " ", 
          RowBox[{"node", "--"}]}], "-", 
         RowBox[{"also", " ", "relabel", " ", 
          RowBox[{"vertices", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"dag2", "=", 
        RowBox[{"VertexDelete", "[", 
         RowBox[{"DAGtemp", ",", "todelete"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ver", "=", 
        RowBox[{"VertexList", "[", "dag2", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ver2", "=", 
        RowBox[{"Replace", "[", 
         RowBox[{"ver", ",", 
          RowBox[{
           RowBox[{"p_", "/;", 
            RowBox[{"p", ">", "todelete"}]}], "\[Rule]", " ", 
           RowBox[{"p", "-", "1"}]}], ",", 
          RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DAG", "[", "tag", "]"}], "=", 
        RowBox[{"Graph", "[", 
         RowBox[{"ver", ",", 
          RowBox[{"EdgeList", "[", "dag2", "]"}], ",", 
          RowBox[{"VertexLabels", "\[Rule]", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ver", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "\[Rule]", " ", 
              RowBox[{"ver2", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", 
               RowBox[{"Length", "[", "ver", "]"}]}], "}"}]}], "]"}]}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "List", " ", "of", " ", "dimensions", " ", "after", " ", "deleting", 
         " ", "the", " ", "node"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"subdimensions", "[", "tag", "]"}], "=", 
        RowBox[{"Delete", "[", 
         RowBox[{"subdimensionstemp", ",", "todelete"}], "]"}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.698963064328925*^9, 3.698963281041743*^9}, {
   3.6989633261450725`*^9, 3.6989633552303495`*^9}, 3.698963410359316*^9, {
   3.698963505053783*^9, 3.698963530788009*^9}, {3.69896364644858*^9, 
   3.698963647651084*^9}, {3.698963721581973*^9, 3.6989637218239*^9}, {
   3.69896379527911*^9, 3.698963795345272*^9}, {3.698964008244234*^9, 
   3.698964016118665*^9}, {3.69896536205311*^9, 3.698965380140073*^9}, 
   3.6991414690166464`*^9, {3.6991535198678403`*^9, 3.6991535240984592`*^9}, {
   3.699154408348214*^9, 3.6991546343604956`*^9}, {3.699155349443989*^9, 
   3.699155389297014*^9}, {3.6993988468835506`*^9, 3.6993988761177177`*^9}, {
   3.699398909008711*^9, 3.6993989369947405`*^9}, {3.699399006807047*^9, 
   3.6993990825580616`*^9}, 3.6993991170673203`*^9, {3.6993992270610485`*^9, 
   3.6993992284453945`*^9}, 3.699399592124168*^9, {3.699400601019243*^9, 
   3.6994007011333904`*^9}, {3.699400767604983*^9, 3.69940121176148*^9}, {
   3.699401302827835*^9, 3.699401306557933*^9}, {3.699401393009592*^9, 
   3.699401407562842*^9}, {3.6994015375361137`*^9, 3.6994015538099575`*^9}, {
   3.6994020947628345`*^9, 3.6994021202362213`*^9}, {3.699403246331482*^9, 
   3.6994032501333656`*^9}, {3.6994067292432837`*^9, 
   3.6994068864257393`*^9}, {3.6994131274290514`*^9, 3.699413127865177*^9}, 
   3.699414375473177*^9, {3.699432185394515*^9, 3.69943226914019*^9}, {
   3.6994323090698013`*^9, 3.6994323600848265`*^9}, {3.699432394779211*^9, 
   3.699432444042286*^9}, {3.699433863922048*^9, 3.699433893926365*^9}, 
   3.6994341808690357`*^9, 3.699434365005842*^9, {3.699436545312076*^9, 
   3.6994366320708623`*^9}, {3.699476412440989*^9, 3.6994764126094804`*^9}, {
   3.699476476548605*^9, 3.699476520477295*^9}, 3.699480299725153*^9, {
   3.6999110873893337`*^9, 3.6999110891081066`*^9}, {3.699911142858782*^9, 
   3.699911176890424*^9}, 3.6999112237034855`*^9, {3.6999112697097635`*^9, 
   3.699911307303936*^9}, {3.699911411773945*^9, 3.6999114184999886`*^9}, {
   3.6999114516722555`*^9, 3.6999114610786443`*^9}, {3.6999117857856536`*^9, 
   3.6999118243642516`*^9}, {3.6999119434750834`*^9, 
   3.6999119570533504`*^9}, {3.69991207886734*^9, 3.699912086445529*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell[BoxData[
 StyleBox[
  RowBox[{"(*", 
   RowBox[{"Conversion", " ", "and", " ", "export", " ", "tools"}], "*)"}],
  FontSize->18,
  FontWeight->"Plain"]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 CellChangeTimes->{
  3.6991415374689016`*^9, {3.6994142250913363`*^9, 3.6994142317140455`*^9}, {
   3.6994266675072713`*^9, 3.699426668303089*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "Convert"}], " ", "a", " ", "list", " ", "of", " ", 
    "channels", " ", "into", " ", "a", " ", "DAG"}], " ", "***)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"toDAG", "[", "chan_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"edg", ",", "l", ",", "convchann"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"l", "=", 
        RowBox[{"Length", "[", "chan", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"convchann", "=", 
        RowBox[{"Replace", "[", 
         RowBox[{"chan", ",", 
          RowBox[{
           RowBox[{"t_", "/;", 
            RowBox[{
             RowBox[{"Length", "[", "t", "]"}], "\[Equal]", "0"}]}], 
           "\[Rule]", " ", 
           RowBox[{"{", 
            RowBox[{"t", ",", "1"}], "}"}]}], ",", 
          RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"edg", "=", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"convchann", "[", 
               RowBox[{"[", 
                RowBox[{"j", ",", "1", ",", "k", ",", "1"}], "]"}], "]"}], 
              "\[Rule]", 
              RowBox[{"convchann", "[", 
               RowBox[{"[", 
                RowBox[{"j", ",", "2"}], "]"}], "]"}]}], " ", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"convchann", "[", 
                 RowBox[{"[", 
                  RowBox[{"j", ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], 
            "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "l"}], "}"}]}], "]"}], "//", 
         "Flatten"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Graph", "[", 
        RowBox[{
         RowBox[{"Range", "[", "l", "]"}], ",", "edg", ",", 
         RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "convert", " ", "the", " ", "full", " ", "list", " ", "of", " ", 
     "subsystem", " ", "dimensions", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"din", ",", 
         RowBox[{"{", 
          RowBox[{"dout1", ",", "dout2"}], "}"}], ",", "..."}], "}"}], " ", 
       "into", " ", "the", " ", "list", " ", "of", " ", "dimensions", " ", 
       "needed", " ", "for", " ", "the", " ", "discovery", " ", 
       RowBox[{"code", ":", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"din", ",", "dout"}], "}"}], ",", "..."}], "}"}]}]}]}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"subdimtodim", "[", "subdim_", "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"l", ",", "outfact", ",", 
        RowBox[{"k", "=", "1"}], ",", "out"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"l", "=", 
        RowBox[{"Length", "[", "subdim", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"outfact", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Product", "[", 
           RowBox[{
            RowBox[{"subdim", "[", 
             RowBox[{"[", 
              RowBox[{"j", ",", "2", ",", "i"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"subdim", "[", 
                RowBox[{"[", 
                 RowBox[{"j", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}]}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "l"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"subdim", "[", 
            RowBox[{"[", 
             RowBox[{"k", ",", "1"}], "]"}], "]"}], ",", " ", 
           RowBox[{"outfact", "[", 
            RowBox[{"[", "k", "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "l"}], "}"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Convert", " ", "the", " ", "list", " ", 
     StyleBox["subdimen",
      FontSlant->"Italic"], " ", "of", " ", "subsystem", " ", "dimensions", 
     " ", "into", " ", "the", " ", "format", " ", "to", " ", "be", " ", 
     "used", " ", "in", " ", "the", " ", "discovery", " ", "code"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"subdimformatlab", "[", "subdimen_", "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"numout", ",", "tab", ",", "string", ",", "subdimstring", ",", 
        RowBox[{"k", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"numout", "[", "k_", "]"}], ":=", 
        RowBox[{"Length", "[", 
         RowBox[{"subdimen", "[", 
          RowBox[{"[", 
           RowBox[{"k", ",", "2"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tab", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"numout", "[", "k", "]"}], "\[Equal]", "1"}], ",", 
            "Nothing", ",", 
            RowBox[{"numout", "[", "k", "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "1", ",", 
            RowBox[{"Length", "[", "subdimen", "]"}]}], "}"}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"subdimstring", "[", "k_", "]"}], ":=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"numout", "[", "k", "]"}], "\[Equal]", "1"}], ",", 
          "Nothing", ",", "\[IndentingNewLine]", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"\"\<subdim{\>\"", ",", 
              RowBox[{"ToString", "[", "k", "]"}], ",", "\"\<} = [\>\"", ",", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"ToString", "[", 
                   RowBox[{"subdimen", "[", 
                    RowBox[{"[", 
                    RowBox[{"k", ",", "2", ",", "j"}], "]"}], "]"}], "]"}], 
                  ",", "\"\< \>\""}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"subdimen", "[", 
                    RowBox[{"[", 
                    RowBox[{"k", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}]}], 
               "]"}], ",", "\"\<];\\n\>\""}], "}"}], "]"}], "]"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"subdimstring", "[", "k", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "1", ",", 
            RowBox[{"Length", "[", "subdimen", "]"}]}], "}"}]}], "]"}], 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 CellChangeTimes->{{3.6935275028232718`*^9, 3.6935276863706117`*^9}, {
   3.6935277409947996`*^9, 3.693527742744422*^9}, {3.6935277828815317`*^9, 
   3.693527856865125*^9}, {3.6935279301249957`*^9, 3.6935280137536345`*^9}, 
   3.6935280468044863`*^9, {3.693535752578293*^9, 3.6935357554307613`*^9}, {
   3.693536017897404*^9, 3.6935360224573216`*^9}, 3.69353615731534*^9, {
   3.6935362087795*^9, 3.6935362660979795`*^9}, 3.6942111771845713`*^9, {
   3.694211222088895*^9, 3.6942112344562273`*^9}, {3.6989705364821987`*^9, 
   3.698970537221506*^9}, {3.6989707903076744`*^9, 3.6989708012786508`*^9}, 
   3.6989751747257147`*^9, {3.698978212390189*^9, 3.6989782814128838`*^9}, {
   3.6989786080428348`*^9, 3.6989786223487406`*^9}, {3.698978705676135*^9, 
   3.698978734718831*^9}, {3.69897894544727*^9, 3.698979002128953*^9}, {
   3.6989790600810165`*^9, 3.698979067837126*^9}, {3.6989791092700644`*^9, 
   3.698979109823801*^9}, 3.6991385400086555`*^9, {3.6991415083576374`*^9, 
   3.6991415374689016`*^9}, {3.699426718880359*^9, 3.6994267194813128`*^9}, {
   3.699475366848155*^9, 3.6994753829020634`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Export", " ", "the", " ", "model", " ", "labeled", " ", "by", " ", 
    StyleBox["tag",
     FontSlant->"Italic"]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"exportformatlab", "[", "tag_", "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Remember", " ", "to", " ", "set", " ", "directory", " ", "before", 
         " ", 
         RowBox[{"export", ".", " ", "Otherwise"}], " ", "it", " ", "exports",
          " ", "to", " ", "the", " ", "documents", " ", "folder"}], ",", " ", 
        RowBox[{"or", " ", "somewhere"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"SetDirectory", "[", 
        RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"StringJoin", "[", 
          RowBox[{"\"\<dmat\>\"", ",", 
           RowBox[{"ToString", "[", "tag", "]"}], ",", "\"\<.dat\>\""}], 
          "]"}], ",", 
         RowBox[{"subdimtodim", "[", 
          RowBox[{"subdimensions", "[", "tag", "]"}], "]"}], ",", 
         "\"\<Table\>\""}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"StringJoin", "[", 
          RowBox[{"\"\<W\>\"", ",", 
           RowBox[{"ToString", "[", "tag", "]"}], ",", "\"\<.dat\>\""}], 
          "]"}], ",", 
         RowBox[{"W", "[", "tag", "]"}], ",", "\"\<Table\>\""}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"StringJoin", "[", 
          RowBox[{"\"\<subdim\>\"", ",", 
           RowBox[{"ToString", "[", "tag", "]"}], ",", "\"\<.m\>\""}], "]"}], 
         ",", 
         RowBox[{"subdimformatlab", "[", 
          RowBox[{"subdimensions", "[", "tag", "]"}], "]"}], ",", 
         "\"\<Text\>\""}], "]"}], ";"}]}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Export", " ", "the", " ", "model", " ", "to", " ", "a", " ", "custom", 
     " ", "directory"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"exportformatlab", "[", 
     RowBox[{"tag_", ",", "dir_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Remember", " ", "to", " ", "set", " ", "directory", " ", "before", 
         " ", 
         RowBox[{"export", ".", " ", "Otherwise"}], " ", "it", " ", "exports",
          " ", "to", " ", "the", " ", "documents", " ", "folder"}], ",", " ", 
        RowBox[{"or", " ", "somewhere"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"SetDirectory", "[", "dir", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"StringJoin", "[", 
          RowBox[{"\"\<dmat\>\"", ",", 
           RowBox[{"ToString", "[", "tag", "]"}], ",", "\"\<.dat\>\""}], 
          "]"}], ",", 
         RowBox[{"subdimtodim", "[", 
          RowBox[{"subdimensions", "[", "tag", "]"}], "]"}], ",", 
         "\"\<Table\>\""}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"StringJoin", "[", 
          RowBox[{"\"\<W\>\"", ",", 
           RowBox[{"ToString", "[", "tag", "]"}], ",", "\"\<.dat\>\""}], 
          "]"}], ",", 
         RowBox[{"W", "[", "tag", "]"}], ",", "\"\<Table\>\""}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"StringJoin", "[", 
          RowBox[{"\"\<subdim\>\"", ",", 
           RowBox[{"ToString", "[", "tag", "]"}], ",", "\"\<.m\>\""}], "]"}], 
         ",", 
         RowBox[{"subdimformatlab", "[", 
          RowBox[{"subdimensions", "[", "tag", "]"}], "]"}], ",", 
         "\"\<Text\>\""}], "]"}], ";"}]}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Alternative", " ", "export", " ", 
      RowBox[{"function", ":", " ", 
       RowBox[{"export", " ", "with", " ", "fixed", " ", "file", " ", 
        RowBox[{"names", ".", "\[IndentingNewLine]", 
         RowBox[{"exportformatlab", "[", "tag_", "]"}]}]}]}]}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Remember", " ", "to", " ", "set", " ", "directory", " ", "before", 
          " ", 
          RowBox[{"export", ".", " ", "Otherwise"}], " ", "it", " ", 
          "exports", " ", "to", " ", "the", " ", "documents", " ", "folder"}],
          ",", " ", 
         RowBox[{"or", " ", "somewhere"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SetDirectory", "[", 
         RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{
          RowBox[{"StringJoin", "[", 
           RowBox[{"\"\<dmat\>\"", ",", 
            RowBox[{"ToString", "[", "tag", "]"}], ",", "\"\<.dat\>\""}], 
           "]"}], ",", 
          RowBox[{"subdimtodim", "[", 
           RowBox[{"subdimensions", "[", "tag", "]"}], "]"}], ",", 
          "\"\<Table\>\""}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{
          RowBox[{"StringJoin", "[", 
           RowBox[{"\"\<W\>\"", ",", 
            RowBox[{"ToString", "[", "tag", "]"}], ",", "\"\<.dat\>\""}], 
           "]"}], ",", 
          RowBox[{"W", "[", "tag", "]"}], ",", "\"\<Table\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{
          RowBox[{"StringJoin", "[", 
           RowBox[{"\"\<subdim\>\"", ",", 
            RowBox[{"ToString", "[", "tag", "]"}], ",", "\"\<.dat\>\""}], 
           "]"}], ",", 
          RowBox[{"subdimformatlab", "[", 
           RowBox[{"subdimensions", "[", "tag", "]"}], "]"}]}], "]"}], 
        ";"}]}], "\[IndentingNewLine]", "]"}]}], "*)"}]}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 CellChangeTimes->{{3.697096479991024*^9, 3.697096673392085*^9}, {
   3.697096739590034*^9, 3.697096795152915*^9}, {3.697097027517007*^9, 
   3.6970970778307467`*^9}, {3.6970971488839655`*^9, 
   3.6970971572442913`*^9}, {3.697097188437418*^9, 3.697097258533124*^9}, {
   3.697097373836932*^9, 3.6970974482052135`*^9}, {3.6970975263188667`*^9, 
   3.697097527041498*^9}, {3.697426224765663*^9, 3.697426224820718*^9}, {
   3.6974278898930273`*^9, 3.697427893334163*^9}, {3.6987112295437293`*^9, 
   3.69871126401904*^9}, {3.6989706440870566`*^9, 3.698970668770683*^9}, {
   3.6989708132258544`*^9, 3.6989708336156893`*^9}, {3.6989708744721174`*^9, 
   3.698971080382797*^9}, {3.6989712534845343`*^9, 3.698971268753232*^9}, {
   3.698971320216121*^9, 3.6989713608800573`*^9}, 3.6989715747431755`*^9, {
   3.6989751382266183`*^9, 3.698975164429816*^9}, {3.6989780323906307`*^9, 
   3.6989780357738338`*^9}, {3.698978121040186*^9, 3.698978121043688*^9}, {
   3.698979817733179*^9, 3.698979825439953*^9}, 3.6991415374689016`*^9, 
   3.699435899933114*^9, {3.6994379020283146`*^9, 3.6994379498871746`*^9}, {
   3.6994380822708006`*^9, 3.6994381010481625`*^9}, {3.699438277846184*^9, 
   3.6994383078063297`*^9}, {3.69947541710037*^9, 3.6994754616895933`*^9}, {
   3.699479288995737*^9, 3.6994792899467354`*^9}}]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Use of the functions and examples", "Section",
 CellChangeTimes->{{3.6994137354568563`*^9, 3.699413736795985*^9}, {
   3.6994137692119436`*^9, 3.699413803351174*^9}, {3.6994139122563744`*^9, 
   3.6994139172966366`*^9}, 3.6994142452329473`*^9, {3.699417185503384*^9, 
   3.6994173492150884`*^9}, {3.6994210215270624`*^9, 
   3.6994215393377447`*^9}, {3.6994215751183577`*^9, 3.69942162411474*^9}, {
   3.6994244919490204`*^9, 3.6994245831957803`*^9}, {3.699477396182437*^9, 
   3.6994773971449285`*^9}}],

Cell[TextData[{
 StyleBox["Below we introduce two main functions to generate quantum Markov \
causal models (in the form of process matrices): ",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["causalmodel",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 StyleBox[" and ",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["randommodel",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 StyleBox[", plus some other related functions. ",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["causalmodel",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 StyleBox[" allows for a good flexibility in defining a causal model but \
requires detailed input information. ",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["randommodel",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 StyleBox[" ",
  FontSize->14,
  FontColor->RGBColor[0, 0, 1]],
 StyleBox["provides the simplest and most straightforward way to generate a \
random causal models with a given number of nodes. Below, whenever an example \
is introduced, evaluate the corresponding cell or cell group to show the \
example or assign the value to the example variable. Note that stored \
variable values are deleted when the Mathematica kernel is closed. To be \
saved, the examples generated have to be exported to some external file. Some \
tools to simplify the export procedure are introduced below. Read through and \
make sure you understand the size of the output generated by each function \
before using them on your own.",
  FontSize->14,
  FontColor->GrayLevel[0]]
}], "Text",
 CellChangeTimes->{
  3.699477401197298*^9, {3.699584141585909*^9, 3.699584200149269*^9}}],

Cell[CellGroupData[{

Cell[TextData[StyleBox["causalmodel", "Subsubsection"]], "Subsection",
 CellChangeTimes->{{3.6994773831009035`*^9, 3.6994773915460176`*^9}}],

Cell[TextData[{
 "The function ",
 StyleBox["causalmodel",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 "[",
 StyleBox["subdim,channels",
  FontSlant->"Italic"],
 "] can be used to generate a causal model given a full list of subsystem \
dimensions and of causal arrows. The dimensions are encoded in the first \
input variable, ",
 StyleBox["subdim",
  FontSlant->"Italic"],
 ", as a nested list {",
 Cell[BoxData[
  FormBox[
   StyleBox[
    SubscriptBox["dims", "1"],
    FontSlant->"Italic"], TraditionalForm]]],
 ",",
 Cell[BoxData[
  FormBox[
   StyleBox[
    SubscriptBox["dims", "2"],
    FontSlant->"Italic"], TraditionalForm]]],
 ",...}, where the ",
 StyleBox["j",
  FontSlant->"Italic"],
 "-th element has the form ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    SubscriptBox["dims", "j"],
    FontSlant->"Italic"], TraditionalForm]]],
 "={",
 Cell[BoxData[
  FormBox[
   SubscriptBox["d", 
    SubscriptBox["I", "j"]], TraditionalForm]]],
 ",{",
 Cell[BoxData[
  FormBox[
   SubsuperscriptBox["d", 
    SubscriptBox["O", "j"], "1"], TraditionalForm]]],
 ",",
 Cell[BoxData[
  FormBox[
   SubsuperscriptBox["d", 
    SubscriptBox["O", "j"], "2"], TraditionalForm]]],
 ",...}}, with ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["d", 
    RowBox[{
     SubscriptBox["I", "j"], " "}]], TraditionalForm]]],
 "the input dimension of the ",
 StyleBox["j",
  FontSlant->"Italic"],
 "-th party, ",
 Cell[BoxData[
  FormBox[
   SubsuperscriptBox["d", 
    SubscriptBox["O", "j"], "1"], TraditionalForm]]],
 " the dimension of its first output subsystem (associated with the first \
outgoing arrow), ",
 Cell[BoxData[
  FormBox[
   SubsuperscriptBox["d", 
    SubscriptBox["O", "j"], "2"], TraditionalForm]]],
 " the dimension of the second output subsystem, etc. For a party with one or \
no outgoing arrow, the dimensions are still input in the nested form {",
 Cell[BoxData[
  FormBox[
   SubscriptBox["d", 
    SubscriptBox["I", "j"]], TraditionalForm]]],
 ",{",
 Cell[BoxData[
  FormBox[
   SubscriptBox["d", 
    SubscriptBox["O", "j"]], TraditionalForm]]],
 "}}. The casual arrows are encoded in the second input variable, ",
 StyleBox["channels",
  FontSlant->"Italic"],
 ", as a nested list {",
 Cell[BoxData[
  FormBox[
   SubscriptBox["chan", "1"], TraditionalForm]],
  FontSlant->"Italic"],
 StyleBox[",",
  FontSlant->"Italic"],
 Cell[BoxData[
  FormBox[
   StyleBox[
    SubscriptBox["chan", "2"],
    FontSlant->"Italic"], TraditionalForm]],
  FontSlant->"Italic"],
 ",...}. ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    SubscriptBox["chan", "j"],
    FontSlant->"Italic"], TraditionalForm]],
  FontSlant->"Italic"],
 " defines the set of arrows ending in a single node, ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    SubscriptBox["chan", "j"],
    FontSlant->"Italic"], TraditionalForm]],
  FontSlant->"Italic"],
 "={{",
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    StyleBox["parent",
     FontSlant->"Italic"], "1"], TraditionalForm]]],
 ",",
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    StyleBox["parent",
     FontSlant->"Italic"], "2"], TraditionalForm]]],
 ",..},",
 StyleBox["child",
  FontSlant->"Italic"],
 "}, where ",
 StyleBox["child",
  FontSlant->"Italic"],
 " is a number labeling the party where the arrow arrives and ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox[
     StyleBox["parent",
      FontSlant->"Italic"], "j"], "=", 
    RowBox[{"{", 
     RowBox[{
      StyleBox["party",
       FontSlant->"Italic"], ",", " ", 
      StyleBox["subsystem",
       FontSlant->"Italic"]}], "}"}]}], TraditionalForm]]],
 ", where ",
 StyleBox["party",
  FontSlant->"Italic"],
 " is a number labeling the party where the arrow departs and ",
 StyleBox["subsystem",
  FontSlant->"Italic"],
 " labels the output subsystem of that party associated to the arrow. If the \
parent node has only one outgoing arrow in total, ",
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    StyleBox["parent",
     FontSlant->"Italic"], "j"], TraditionalForm]]],
 " can also be input as a single number denoting the party. The function \
automatically assigns input states to nodes without incoming arrows. Note \
that the elements in ",
 StyleBox["channels",
  FontSlant->"Italic"],
 " can be written in an arbitrary order, what counts are the numbers that \
label the parties, which must be 1,...,",
 StyleBox["n",
  FontSlant->"Italic"],
 ". Each input system and output subsystem can appear at most once in the \
list ",
 StyleBox["channels",
  FontSlant->"Italic"],
 ", otherwise the code will produce an error or an incorrect process matrix.\n\
\nAs a simple example, consider a bipartite causal model, were each node has \
input and output dimension 2 and only one arrow from the first to the second \
node, ",
 Cell[BoxData[
  GraphicsBox[
   NamespaceBox["NetworkGraphics",
    DynamicModuleBox[{Typeset`graph = HoldComplete[
      Graph[{1, 2}, {{{1, 2}}, Null}, {VertexLabels -> {Automatic}}]]}, 
     TagBox[GraphicsGroupBox[{
        {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[Medium], 
         ArrowBox[{{1., 0.}, {0., 1.2246467991473532`*^-16}}, 0.01273]}, 
        {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[
         0.7]}], {DiskBox[{1., 0.}, 0.01273], 
          InsetBox["1", Offset[{2, 2}, {1.01273, 0.01273}], ImageScaled[{0, 0}],
           BaseStyle->"Graphics"]}, {
          DiskBox[{0., 1.2246467991473532*^-16}, 0.01273], 
          InsetBox["2", Offset[{2, 2}, {0.01273, 0.012730000000000123}], 
           ImageScaled[{0, 0}],
           BaseStyle->"Graphics"]}}}],
      MouseAppearanceTag["NetworkGraphics"]],
     AllowKernelInitialization->False]],
   DefaultBaseStyle->{
    "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
   FormatType->TraditionalForm,
   FrameTicks->None,
   ImageSize->{114., Automatic}]], "Output",
  GeneratedCell->False,
  CellAutoOverwrite->False,
  CellChangeTimes->{{3.6994251703631363`*^9, 3.6994252074144297`*^9}}],
 ". The list of dimensions and of arrows are given respectively as"
}], "Text",
 CellChangeTimes->{{3.699413815145616*^9, 3.699413815578636*^9}, {
   3.6994139310839415`*^9, 3.6994140532459583`*^9}, {3.699414394967003*^9, 
   3.699414429375699*^9}, {3.6994144958734617`*^9, 3.6994145440352783`*^9}, {
   3.6994146073636613`*^9, 3.699414794579914*^9}, {3.6994148305622587`*^9, 
   3.6994156416614733`*^9}, {3.699415688436905*^9, 3.6994159101597757`*^9}, {
   3.6994159501090775`*^9, 3.699416105331109*^9}, {3.6994162244062157`*^9, 
   3.6994162482144976`*^9}, {3.699416288849291*^9, 3.6994164339846754`*^9}, {
   3.6994165188315325`*^9, 3.699416568189315*^9}, {3.6994166721463957`*^9, 
   3.6994167477210703`*^9}, {3.699416780922372*^9, 3.699416829434911*^9}, {
   3.6994169158022594`*^9, 3.699417071848709*^9}, {3.6994171192132044`*^9, 
   3.699417170508439*^9}, {3.699421017531542*^9, 3.6994210183360825`*^9}, {
   3.699421262348818*^9, 3.6994212627556024`*^9}, {3.699424829278767*^9, 
   3.699424860216283*^9}, {3.699424904542832*^9, 3.699424933676896*^9}, {
   3.6994252145412855`*^9, 3.6994252436482563`*^9}, {3.6994252943629932`*^9, 
   3.6994252953943567`*^9}, {3.6994254743937936`*^9, 3.699425499638829*^9}, {
   3.6994255372954435`*^9, 3.6994255721180706`*^9}, {3.6994260913718624`*^9, 
   3.6994261894730206`*^9}, 3.6994773681481953`*^9, {3.6994778344425163`*^9, 
   3.6994779467218285`*^9}, {3.6994779819312506`*^9, 3.6994780222530794`*^9}, 
   3.6994796435514073`*^9, {3.6995705417799315`*^9, 3.699570670442436*^9}, {
   3.6995707255879803`*^9, 3.699570726333911*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"subdim", "[", "simplest", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"2", ",", 
       RowBox[{"{", "2", "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", 
       RowBox[{"{", "2", "}"}]}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"channels", "[", "simplest", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", "1", "}"}], ",", "2"}], "}"}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6994167528142967`*^9, 3.6994167770613976`*^9}, {
  3.6994168311472893`*^9, 3.6994168504055214`*^9}, {3.699417518200221*^9, 
  3.6994175227990856`*^9}, {3.6994262089115057`*^9, 3.699426210379509*^9}, {
  3.6995702513987017`*^9, 3.699570266862878*^9}, {3.6995704845757537`*^9, 
  3.699570507808386*^9}}],

Cell[TextData[{
 "The function ",
 StyleBox["causalmodel",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 StyleBox[", given the above inputs, generates a process matrix of the form ",
  FontColor->GrayLevel[0]],
 Cell[BoxData[
  FormBox[
   RowBox[{"W", "=", 
    SuperscriptBox["\[Rho]", 
     SubscriptBox["A", "I"]]}], TraditionalForm]]],
 Cell[BoxData[
  FormBox["\[CircleTimes]", TraditionalForm]]],
 Cell[BoxData[
  FormBox[
   SuperscriptBox["T", 
    RowBox[{
     SubscriptBox["A", "o"], 
     SubscriptBox["B", "I"]}]], TraditionalForm]]],
 Cell[BoxData[
  FormBox["\[CircleTimes]", TraditionalForm]]],
 Cell[BoxData[
  FormBox[
   SuperscriptBox["\[ImaginaryI]", 
    SubscriptBox["B", "O"]], TraditionalForm]]],
 ", where ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["\[Rho]", 
    SubscriptBox["A", "I"]], TraditionalForm]]],
 "is a random density matrix and ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["T", 
    RowBox[{
     SubscriptBox["A", "o"], 
     SubscriptBox["B", "I"]}]], TraditionalForm]]],
 " is the Choi matrix of a random channel (the \
\[OpenCurlyDoubleQuote]randomness\[CloseCurlyDoubleQuote] is discussed \
below). "
}], "Text",
 CellChangeTimes->{{3.699417376609*^9, 3.6994173787876577`*^9}, {
   3.699417587136835*^9, 3.6994181057477727`*^9}, {3.699418137201872*^9, 
   3.6994181582635612`*^9}, 3.69941873470405*^9, 3.699478070629603*^9, {
   3.6994781353528395`*^9, 3.6994781356681876`*^9}, {3.7211973054197884`*^9, 
   3.721197340116314*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"W", "[", "simplest", "]"}], "=", 
   RowBox[{"causalmodel", "[", 
    RowBox[{
     RowBox[{"subdim", "[", "simplest", "]"}], ",", 
     RowBox[{"channels", "[", "simplest", "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.69941657172827*^9, 3.699416659633299*^9}, {
  3.6994168622840347`*^9, 3.6994168745983334`*^9}, {3.6994173962498026`*^9, 
  3.699417425513098*^9}, {3.6994175488884897`*^9, 3.699417578819446*^9}, {
  3.69941816421282*^9, 3.699418176310584*^9}, {3.699418213134589*^9, 
  3.6994182215549536`*^9}, {3.699418332724159*^9, 3.6994183414916596`*^9}}],

Cell["\<\
We can verify that this matrix is positive semidefinite and has the expected \
dimensions and normalisation:\
\>", "Text",
 CellChangeTimes->{{3.6994182271943817`*^9, 3.6994182928543825`*^9}, {
  3.69941838083139*^9, 3.6994183872214375`*^9}}],

Cell[BoxData[{
 RowBox[{"Chop", "[", 
  RowBox[{"Eigenvalues", "[", 
   RowBox[{"W", "[", "simplest", "]"}], "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", 
  RowBox[{"W", "[", "simplest", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Tr", "[", 
  RowBox[{"W", "[", "simplest", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.699418401528119*^9, 3.699418434534766*^9}}],

Cell[TextData[{
 StyleBox["Note that the second element of ",
  FontColor->GrayLevel[0]],
 StyleBox["channels",
  FontWeight->"Bold",
  FontColor->GrayLevel[0]],
 StyleBox["[",
  FontColor->GrayLevel[0]],
 StyleBox["simplest",
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox["], {{1},2}, defining the only causal arrow in the model, can \
equivalently be represented as {{{1,1}},2}. ",
  FontColor->GrayLevel[0]],
 "\n\nA  less trivial example is a common/direct-cause structure: ",
 Cell[BoxData[
  GraphicsBox[
   NamespaceBox["NetworkGraphics",
    DynamicModuleBox[{Typeset`graph = HoldComplete[
      Graph[{2, 1, 3}, {{{1, 2}, {1, 3}, {3, 2}}, Null}, {
       VertexLabels -> {Automatic}}]]}, 
     TagBox[GraphicsGroupBox[{
        {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[Medium], 
         ArrowBox[BezierCurveBox[CompressedData["
1:eJxTTMoPSmViYGCQAWIQjQYcZvKamy4+tMJ+knvYs1eW/+3l1q8JvnV4lz2f
6dGoQ8H/7Kv2zBQ9O/mofdEJn9g237/2Gp+mT/A4ds5+D+Pbt2bqf+x9ajLO
rq+5Yv/2wVKeKw9+2T9JV5LqFLtlz55WvjO26qf9+7s24hESD+w5JiZ+ufz5
u72sjXnrpNTH9p8SU/aa+X6zr/ZjuP750zP7QzfqRdravthHTA4Vtb/5wj61
S8VPrf6z/bmWUJ+Qtlf293uFbN9mf7J/pMRQY/zrtb3+Y8+Ht3w+2vfnhi65
Y/LWPqTrlNV7xQ/211JCj/qbvbOfz6Y5OeTaW/udHAz3e/69s3ea4y8tEfja
3iwy9OPk3vf2E69y8GlueWHvFxb6J+Xxe/ueTSHZ7f+f2kOC5YO9MRg8hvPn
bey+bp//AM4/x989pXH5bXtGKF8856BYzsFrcHnJil2m9jqX4PwV6W8efT1/
Gs6fYvdyst3Lw3D+g5fX/mzw2Ann/9M608nHugLOh0UYALTwvFk=
          "]], 0.02261146496815286], 
         ArrowBox[{{0., 2.}, {0., 1.}}, 0.02261146496815286], 
         ArrowBox[{{0., 1.}, {1., 0.}}, 0.02261146496815286]}, 
        {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[
         0.7]}], {DiskBox[{0., 2.}, 0.02261146496815286], 
          InsetBox["2", 
           Offset[{2, 2}, {0.02261146496815286, 2.022611464968153}], 
           ImageScaled[{0, 0}],
           BaseStyle->"Graphics"]}, {DiskBox[{1., 0.}, 0.02261146496815286], 
          InsetBox["1", 
           Offset[{2, 2}, {1.0226114649681528, 0.02261146496815286}], 
           ImageScaled[{0, 0}],
           BaseStyle->"Graphics"]}, {DiskBox[{0., 1.}, 0.02261146496815286], 
          InsetBox["3", 
           Offset[{2, 2}, {0.02261146496815286, 1.0226114649681528}], 
           ImageScaled[{0, 0}],
           BaseStyle->"Graphics"]}}}],
      MouseAppearanceTag["NetworkGraphics"]],
     AllowKernelInitialization->False]],
   DefaultBaseStyle->{
    "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
   FormatType->TraditionalForm,
   FrameTicks->None,
   ImageSize->{66.83251228489863, Automatic}]]],
 ". Dimensions, arrows and causal model can be given as:"
}], "Text",
 CellChangeTimes->{{3.699418117354683*^9, 3.699418125239705*^9}, {
   3.699418324540507*^9, 3.699418325225241*^9}, {3.6994184600380926`*^9, 
   3.699418716234609*^9}, {3.699425590368265*^9, 3.6994256344820457`*^9}, {
   3.6994257333113832`*^9, 3.6994257898395133`*^9}, {3.6994258855459957`*^9, 
   3.6994258875902376`*^9}, {3.6994259273369646`*^9, 
   3.6994259314635725`*^9}, {3.699425998901891*^9, 3.699425999563103*^9}, 
   3.699426245563607*^9, {3.6994782131278353`*^9, 3.6994782159581146`*^9}, {
   3.6994796715241604`*^9, 3.699479681404665*^9}, {3.721197677641892*^9, 
   3.721197680318797*^9}, {3.7211980789358273`*^9, 3.7211981283637376`*^9}, {
   3.721198187579647*^9, 3.721198187934243*^9}, {3.7211982455902357`*^9, 
   3.7211982988989573`*^9}, {3.721198417361492*^9, 3.721198465406456*^9}, {
   3.7211985808368545`*^9, 3.7211986289556737`*^9}, {3.7212006104501553`*^9, 
   3.721200613605443*^9}, {3.7212006599146576`*^9, 3.7212007600410566`*^9}, {
   3.7212007986451125`*^9, 3.721200829838609*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"subdim", "[", "common", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"2", ",", 
       RowBox[{"{", "1", "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", 
       RowBox[{"{", "2", "}"}]}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"channels", "[", "common", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}], "}"}], ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", "1"}], "}"}]}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"W", "[", "common", "]"}], "=", 
   RowBox[{"causalmodel", "[", 
    RowBox[{
     RowBox[{"subdim", "[", "common", "]"}], ",", 
     RowBox[{"channels", "[", "common", "]"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6994258187164564`*^9, 3.6994259044379067`*^9}, {
  3.699426033751114*^9, 3.699426037327094*^9}, {3.699426329949901*^9, 
  3.699426367223409*^9}}],

Cell["\<\
Note that the input of node 2 and the output of node 1 are trivial. It can be \
useful to assign trivial input and output spaces to root or sink nodes, \
respectively (i.e., without in- or outgoing arrows), in order to bound the \
size of the process matrix.\
\>", "Text",
 CellChangeTimes->{{3.6994262728490696`*^9, 3.6994263073399296`*^9}, {
   3.6994263822075224`*^9, 3.6994265425584526`*^9}, 3.6994797562037306`*^9}],

Cell[BoxData[{
 RowBox[{"Dimensions", "[", 
  RowBox[{"W", "[", "common", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Tr", "[", 
  RowBox[{"W", "[", "common", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.6994265572821245`*^9, 3.6994265584067*^9}}],

Cell[TextData[{
 "The causal structure can be visualised using the function ",
 StyleBox["toDAG",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 "[",
 StyleBox["chan",
  FontSlant->"Italic"],
 "], which converts a list of arrows ",
 StyleBox["chan",
  FontSlant->"Italic"],
 ", given in the format used to generate a causal model, into a directed \
acyclic graph (DAG): "
}], "Text",
 CellChangeTimes->{{3.6994265921022005`*^9, 3.6994266532441316`*^9}, {
  3.6994267331260843`*^9, 3.699426829529955*^9}, {3.721200861178837*^9, 
  3.721200881679449*^9}}],

Cell[BoxData[{
 RowBox[{"toDAG", "[", 
  RowBox[{"channels", "[", "simplest", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"toDAG", "[", 
  RowBox[{"channels", "[", "common", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.6994266573463907`*^9, 3.699426657359937*^9}, {
  3.699426837698383*^9, 3.699426861919335*^9}}],

Cell[TextData[{
 "\n",
 StyleBox["Each evaluation produces a different matrix. By default,",
  FontColor->GrayLevel[0]],
 StyleBox[" ",
  FontColor->RGBColor[0, 0, 1]],
 StyleBox["causalmodel",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 " samples randomly among states and channels following the methods of Refs. \
[1,2], adapted to produce matrices with only real entries. This is in order \
to facilitate the export of the matrices for use in the MatLab code. In order \
to generate general channels with complex entries it is sufficient to \
substitute ",
 StyleBox["Ginibre ",
  FontWeight->"Bold",
  FontColor->RGBColor[0., 0., 1.]],
 "\[Rule] ",
 StyleBox["RGinibre",
  FontWeight->"Bold",
  FontColor->RGBColor[0., 0., 1.]],
 " in the definition of the function ",
 StyleBox["chanpos",
  FontWeight->"Bold",
  FontColor->RGBColor[0., 0., 1.]],
 ", in the section \[OpenCurlyDoubleQuote]Code to generate process matrices \
and causal models\[CloseCurlyDoubleQuote] above."
}], "Text",
 CellChangeTimes->{{3.6994265921022005`*^9, 3.6994266532441316`*^9}, {
  3.6994267331260843`*^9, 3.699426829529955*^9}, {3.721200861178837*^9, 
  3.721200889039402*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["randommodel", "Subsection",
 CellChangeTimes->{{3.699426951693782*^9, 3.699427059108998*^9}, {
  3.699427089728767*^9, 3.699427375527316*^9}, {3.69942767973409*^9, 
  3.699427699309882*^9}, {3.6994773326851883`*^9, 3.6994773341380663`*^9}}],

Cell[TextData[{
 StyleBox["The function ",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["randommodel",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 StyleBox["[",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["n",
  FontSize->14,
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox[",",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["tag",
  FontSize->14,
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox["] is the quickest way to generate sets of example models. The \
first input variable, ",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["n",
  FontSize->14,
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox[", is the number of nodes (parties) in the model, while the second \
input, ",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["tag",
  FontSize->14,
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox[", is an arbitrary string used to label the model generated. When \
evaluated, the function generates a random DAG, named ",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["DAG",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->GrayLevel[0]],
 StyleBox["[tag], a list of arrows (in the format used by the function ",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["causalmodel",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 StyleBox[" above) named ",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["channels",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->GrayLevel[0]],
 StyleBox["[",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["tag",
  FontSize->14,
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox["], a list of subsystem dimensions (also in the format described \
above), named ",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["subdimensions",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->GrayLevel[0]],
 StyleBox["[",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["tag",
  FontSize->14,
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox["], and finally a process matrix, named ",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["W",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->GrayLevel[0]],
 StyleBox["[",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["tag",
  FontSize->14,
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox["], which is Markovian with respect to ",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["DAG",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->GrayLevel[0]],
 StyleBox["[",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["tag",
  FontSize->14,
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox["].",
  FontSize->14,
  FontColor->GrayLevel[0]]
}], "Text",
 CellChangeTimes->{
  3.69947733748429*^9, {3.6994783487769313`*^9, 3.6994783830716486`*^9}, {
   3.699479824149744*^9, 3.69947982888202*^9}}],

Cell[BoxData[{
 RowBox[{"randommodel", "[", 
  RowBox[{"4", ",", "example"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"DAG", "[", "example", "]"}], "\[IndentingNewLine]", 
 RowBox[{"channels", "[", "example", "]"}], "\[IndentingNewLine]", 
 RowBox[{"subdimensions", "[", "example", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", 
  RowBox[{"W", "[", "example", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.6994273799337363`*^9, 3.6994274484582367`*^9}}],

Cell[TextData[{
 "By default, ",
 StyleBox["randommodel",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 " assigns output dimension 1 to all sink nodes and dimension 2 to all other \
output subsystems and input systems. The dimension 2 is set by a function \
parameter \[OpenCurlyDoubleQuote]",
 StyleBox["dim",
  FontSlant->"Italic"],
 "\[CloseCurlyDoubleQuote], which can be changed in the definition of the \
function in the introduction. Note that trivial sinks\[CloseCurlyQuote] \
output systems simplify the task of causal discovery, since the \
\[OpenCurlyDoubleQuote]last\[CloseCurlyDoubleQuote] parties are fixed in \
advance (and there are no \[OpenCurlyDoubleQuote]open subsystems\
\[CloseCurlyDoubleQuote], see main article). More general causal models can \
be generated with the function ",
 StyleBox["openrandommodel",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 "[",
 StyleBox["n",
  FontSlant->"Italic"],
 ",",
 StyleBox["tag",
  FontSlant->"Italic"],
 "]. This works in a similar way as ",
 StyleBox["randommodel",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 ", but generates first a model with ",
 StyleBox["n",
  FontSlant->"Italic"],
 "+1 nodes and then traces out a randomly chosen one, leaving some nodes with \
no outgoing arrow but non-trivial output space (or with some \
\[OpenCurlyDoubleQuote]open subsystem\[CloseCurlyDoubleQuote]). ",
 StyleBox["openrandommodel",
  FontSize->14,
  FontWeight->"Bold",
  FontSlant->"Italic",
  FontColor->RGBColor[0, 0, 1]],
 " generates the process matrix ",
 StyleBox["W",
  FontWeight->"Bold"],
 "[",
 StyleBox["tag",
  FontSlant->"Italic"],
 "], the graph ",
 StyleBox["DAG",
  FontWeight->"Bold"],
 "[",
 StyleBox["tag",
  FontSlant->"Italic"],
 "], and the lists of dimensions ",
 StyleBox["subdimensions",
  FontWeight->"Bold"],
 "[",
 StyleBox["tag",
  FontSlant->"Italic"],
 "], but no list of arrows. Note that, since it needs to generate a larger \
model, this function can be considerably slower."
}], "Text",
 CellChangeTimes->{{3.6994274659458866`*^9, 3.6994275546942005`*^9}, {
   3.699427716648984*^9, 3.699427750399192*^9}, {3.6994278708886147`*^9, 
   3.6994281529566755`*^9}, {3.699428187852952*^9, 3.699428346187851*^9}, {
   3.699428394471804*^9, 3.699428407431749*^9}, {3.6994284403358173`*^9, 
   3.6994285332909718`*^9}, {3.699428631692428*^9, 3.699428666495578*^9}, 
   3.699428709683014*^9, {3.6994366491552696`*^9, 3.699436676728423*^9}, {
   3.6994784888705683`*^9, 3.699478511683243*^9}}],

Cell[BoxData[{
 RowBox[{"openrandommodel", "[", 
  RowBox[{"3", ",", "open"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"DAG", "[", "open", "]"}], "\[IndentingNewLine]", 
 RowBox[{"subdimensions", "[", "open", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", 
  RowBox[{"W", "[", "open", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Tr", "[", 
  RowBox[{"W", "[", "open", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.6994130764954453`*^9, 3.6994130922292905`*^9}, {
  3.699428604091832*^9, 3.6994286041698723`*^9}, {3.699428979854827*^9, 
  3.699429021503471*^9}, {3.6994366902077*^9, 3.699436694828562*^9}, {
  3.699436730783907*^9, 3.699436730837344*^9}, {3.699436911967354*^9, 
  3.6994369129978547`*^9}, {3.699436955850098*^9, 3.6994370191859903`*^9}, {
  3.6994372127407427`*^9, 3.6994372207226777`*^9}, {3.6994373275590477`*^9, 
  3.699437330621935*^9}}],

Cell[TextData[{
 "It is also possible to generate causal structures, without the associated \
process matrices, using the function ",
 StyleBox["randomstructure",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 "[",
 StyleBox["n",
  FontSlant->"Italic"],
 ",",
 StyleBox["tag",
  FontSlant->"Italic"],
 "]. This produces all variables as ",
 StyleBox["randommodel",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 ", except ",
 StyleBox["W",
  FontWeight->"Bold"],
 "[",
 StyleBox["tag",
  FontSlant->"Italic"],
 "]. "
}], "Text",
 CellChangeTimes->{{3.699429055203455*^9, 3.6994290567128134`*^9}, {
   3.6994290964146786`*^9, 3.699429279393055*^9}, 3.699435438207322*^9, {
   3.699479925987525*^9, 3.6994799260248117`*^9}}],

Cell[BoxData[{
 RowBox[{
  StyleBox["randomstructure",
   FontColor->GrayLevel[0]], "[", 
  RowBox[{"12", ",", "large"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"subdimensions", "[", "large", "]"}], "\[IndentingNewLine]", 
 RowBox[{"channels", "[", "large", "]"}], "\[IndentingNewLine]", 
 RowBox[{"DAG", "[", "large", "]"}]}], "Input",
 CellChangeTimes->{{3.699429280983175*^9, 3.699429296657468*^9}, {
   3.6994293419041157`*^9, 3.699429360419689*^9}, {3.6994308350000134`*^9, 
   3.699430840948519*^9}, {3.6994346385564137`*^9, 3.6994346386224604`*^9}, 
   3.699434762529976*^9, 3.699434796143011*^9, {3.6994348455614843`*^9, 
   3.6994348456240606`*^9}}],

Cell[TextData[{
 "The process matrix associated to a causal structure generated in this way \
can be obtained by feeding the outputs ",
 StyleBox["subdimensions",
  FontWeight->"Bold"],
 "[",
 StyleBox["large",
  FontSlant->"Italic"],
 "] and ",
 StyleBox["channels",
  FontWeight->"Bold"],
 "[",
 StyleBox["large",
  FontSlant->"Italic"],
 "] to the function ",
 StyleBox["causalmodel",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 ". Before doing so, make sure you understand the size of the matrix to be \
generated."
}], "Text",
 CellChangeTimes->{{3.6994786198177156`*^9, 3.6994787693966093`*^9}, {
   3.6994788009072127`*^9, 3.699478819300321*^9}, 3.699479944753042*^9}],

Cell[TextData[{
 "In the functions above, the number of edges in a graph with ",
 StyleBox["n",
  FontSlant->"Italic"],
 " nodes is chosen randomly between 1 and ",
 StyleBox["Binomial",
  FontWeight->"Bold"],
 "[",
 StyleBox["n",
  FontSlant->"Italic"],
 ",2] (the maximal number of edges in a simple graph with ",
 StyleBox["n",
  FontSlant->"Italic"],
 " vertices). This can produce quite large process matrices: for example, for \
",
 StyleBox["n",
  FontSlant->"Italic"],
 " nodes and ",
 StyleBox["e",
  FontSlant->"Italic"],
 " edges, ",
 StyleBox["randommodel",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 " produces a process matrix of dimension ",
 Cell[BoxData[
  FormBox[
   RowBox[{"d", "=", 
    SuperscriptBox["2", 
     RowBox[{"#n", " ", "+", " ", "#e"}]]}], TraditionalForm]]],
 "; for ",
 StyleBox["n",
  FontSlant->"Italic"],
 "=7, the  maximum number of edges in ",
 StyleBox["Binomial",
  FontWeight->"Bold"],
 "[7,2]=21, giving a process matrix of dimension ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox["2", "28"], "=", "268435456"}], TraditionalForm]]],
 ". In fact, the kernel can already crash for matrices of size ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["2", "14"], TraditionalForm]],
  FormatType->"TraditionalForm"],
 ", which can be produced with ",
 StyleBox["n",
  FontSlant->"Italic"],
 "=5 for ",
 StyleBox["randommodel",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 " and ",
 StyleBox["n",
  FontSlant->"Italic"],
 "=4 for ",
 StyleBox["openrandommodel",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 ". It can thus be useful to generate models with a fixed, smaller number of \
edges. This can be done simply by adding an extra variable to the functions \
above: ",
 StyleBox["randomstructure",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 "[",
 StyleBox["n",
  FontSlant->"Italic"],
 ",",
 StyleBox["tag",
  FontSlant->"Italic"],
 ",",
 StyleBox["edges",
  FontSlant->"Italic"],
 "], ",
 StyleBox["randommodel",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 StyleBox["[",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["n",
  FontSize->14,
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox[",",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["tag",
  FontSize->14,
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox[",",
  FontSize->14,
  FontColor->GrayLevel[0]],
 StyleBox["edges",
  FontSize->14,
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox["]",
  FontSize->14,
  FontColor->GrayLevel[0]],
 ", and ",
 StyleBox["openrandommodel",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 "[",
 StyleBox["n",
  FontSlant->"Italic"],
 ",",
 StyleBox["tag",
  FontSlant->"Italic"],
 ",",
 StyleBox["edges",
  FontSlant->"Italic"],
 "], where ",
 StyleBox["edges ",
  FontSlant->"Italic"],
 "denotes the total number of arrows."
}], "Text",
 CellChangeTimes->{{3.6994348670597315`*^9, 3.6994349521774335`*^9}, {
  3.699435027483469*^9, 3.6994355189915156`*^9}, {3.6994370578633633`*^9, 
  3.6994370591628966`*^9}, {3.699478871102498*^9, 3.6994789231906796`*^9}, {
  3.699479979347327*^9, 3.6994800076273365`*^9}, {3.6995842222902107`*^9, 
  3.699584394480175*^9}, {3.699584427761874*^9, 3.699584501387946*^9}}],

Cell[BoxData[{
 RowBox[{
  StyleBox["randomstructure",
   FontColor->GrayLevel[0]], "[", 
  RowBox[{"20", ",", "larger", ",", "30"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"DAG", "[", "larger", "]"}]}], "Input",
 CellChangeTimes->{{3.6994355402648163`*^9, 3.6994355743956423`*^9}, {
  3.6994372852012076`*^9, 3.6994372852702055`*^9}}],

Cell[TextData[{
 "For ",
 StyleBox["openrandommodel",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 "[",
 StyleBox["n",
  FontSlant->"Italic"],
 ",",
 StyleBox["tag",
  FontSlant->"Italic"],
 ",",
 StyleBox["edges",
  FontSlant->"Italic"],
 "], ",
 StyleBox["edges",
  FontSlant->"Italic"],
 " actually determines the number of edges in the ",
 StyleBox["n",
  FontSlant->"Italic"],
 "+1-node model, before removing a node. Thus the function typically produces \
a model with less than ",
 StyleBox["edges",
  FontSlant->"Italic"],
 " arrows (the number depends on the connectivity of the node removed)."
}], "Text",
 CellChangeTimes->{{3.6994370452201653`*^9, 3.6994371853808756`*^9}, {
   3.699479014682433*^9, 3.6994790159292417`*^9}, 3.6994805337500267`*^9}],

Cell[BoxData[{
 RowBox[{"openrandommodel", "[", 
  RowBox[{"4", ",", "fixed", ",", "4"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"DAG", "[", "fixed", "]"}], "\[IndentingNewLine]", 
 RowBox[{"subdimensions", "[", "fixed", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", 
  RowBox[{"W", "[", "fixed", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Tr", "[", 
  RowBox[{"W", "[", "fixed", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.699437244390257*^9, 3.6994372474369*^9}, {
   3.699437314466761*^9, 3.699437318464106*^9}, 3.721198974693571*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"W", "[", "fixed", "]"}], "//", "MatrixForm"}]], "Input",
 CellChangeTimes->{{3.7211989844165173`*^9, 3.721198992451544*^9}}],

Cell[TextData[{
 "Note finally that all the functions discussed in this subsection always \
generate causal structures represented by simple graphs, namely with graphs \
where at most one edge connects any pair of nodes. Quantum causal models can \
generally have non-simple causal structures; these can be generated with the \
function ",
 StyleBox["causalmodel",
  FontSize->14,
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 " discussed in the previous subsection."
}], "Text",
 CellChangeTimes->{{3.699437433996952*^9, 3.699437603100272*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Export models", "Section",
 CellChangeTimes->{{3.6994356931101303`*^9, 3.6994356960937304`*^9}, {
  3.6994357589712515`*^9, 3.6994358577570877`*^9}, {3.699435938230548*^9, 
  3.6994360183003397`*^9}, {3.6994360552962465`*^9, 3.699436149464294*^9}, {
  3.699436200841737*^9, 3.6994362062108603`*^9}, {3.699436264943055*^9, 
  3.6994364379051795`*^9}, {3.6994373488372793`*^9, 3.6994374180826607`*^9}, {
  3.6994376092653794`*^9, 3.6994376154157095`*^9}, {3.6994376762291555`*^9, 
  3.69943770685384*^9}, {3.6994384207880716`*^9, 3.699438421040987*^9}, {
  3.699477317957529*^9, 3.699477319657238*^9}}],

Cell[TextData[{
 StyleBox["We present a function to facilitate exporting examples in a format \
that can be used as an input to the causal discovery algorithm. For each \
model, we need to generate three files: \[OpenCurlyDoubleQuote]dmat.dat\
\[CloseCurlyDoubleQuote], containing the list of input and output dimensions, \
\[OpenCurlyDoubleQuote]W.dat\[CloseCurlyDoubleQuote], containing the process \
matrix, and \[OpenCurlyDoubleQuote]subdim.m\[CloseCurlyDoubleQuote], which \
specifies the decomposition of output systems in subsystems. The names of the \
file (but not the extensions) can be changed to differentiate models. The \
function ", "Text",
  FontColor->GrayLevel[0]],
 StyleBox["exportformatlab", "Text",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 StyleBox["[", "Text",
  FontColor->GrayLevel[0]],
 StyleBox["tag", "Text",
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox["]  automatically generates and exports the files corresponding to \
a causal model labelled by \
\[OpenCurlyDoubleQuote]tag\[CloseCurlyDoubleQuote]: if the kernel has in \
memory a process matrix ", "Text",
  FontColor->GrayLevel[0]],
 StyleBox["W", "Text",
  FontWeight->"Bold",
  FontColor->GrayLevel[0]],
 StyleBox["[", "Text",
  FontColor->GrayLevel[0]],
 StyleBox["tag", "Text",
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox["] and a list of subsystem dimensions ", "Text",
  FontColor->GrayLevel[0]],
 StyleBox["subdimensions", "Text",
  FontWeight->"Bold",
  FontColor->GrayLevel[0]],
 StyleBox["[", "Text",
  FontColor->GrayLevel[0]],
 StyleBox["tag", "Text",
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox["], the function exports the files \
\[OpenCurlyDoubleQuote]dmattag.dat\[CloseCurlyDoubleQuote], \
\[OpenCurlyDoubleQuote]Wtag.dat\[CloseCurlyDoubleQuote], and \
\[OpenCurlyDoubleQuote]subdimtag.m\[CloseCurlyDoubleQuote]. (The process \
matrix and list of dimensions can be generated with the above code or in some \
other way.)\n\nFor example, to export the last example generated in the \
previous section, labeled fixed, use (after evaluating the above example)", 
  "Text",
  FontColor->GrayLevel[0]]
}], "Text",
 CellChangeTimes->{
  3.699477325639217*^9, {3.699479120777936*^9, 3.6994791525365934`*^9}, {
   3.699479456673992*^9, 3.6994794628046627`*^9}, {3.6999121075083385`*^9, 
   3.6999122261972127`*^9}}],

Cell[BoxData[
 RowBox[{"exportformatlab", "[", "fixed", "]"}]], "Input",
 CellChangeTimes->{{3.699912232916071*^9, 3.6999122336035557`*^9}}],

Cell[TextData[StyleBox["As another example, we can generate a set of 4-node \
random causal models, labelled by an incremental number", "Text",
 FontColor->GrayLevel[0]]], "Text",
 CellChangeTimes->{{3.6999122196658883`*^9, 3.6999122578694687`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"randommodel", "[", 
     RowBox[{"4", ",", "tag"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"tag", ",", "1", ",", "4"}], "}"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Table", "[", 
  RowBox[{
   RowBox[{"DAG", "[", "tag", "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"tag", ",", "1", ",", "4"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.699437728349409*^9, 3.6994377399316235`*^9}}],

Cell["and we can export all of them at once:", "Text",
 CellChangeTimes->{{3.6994377946145773`*^9, 3.6994378027294426`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"exportformatlab", "[", "tag", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"tag", ",", "1", ",", "4"}], "}"}]}], "]"}], ";"}]], "Input",
 CellChangeTimes->{3.699437814388497*^9, 3.699479518261045*^9}],

Cell[TextData[{
 "By default, ",
 StyleBox["exportformatlab", "Text",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 StyleBox["[", "Text",
  FontColor->GrayLevel[0]],
 StyleBox["tag", "Text",
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox["]", "Text",
  FontColor->GrayLevel[0]],
 " exports the files in the directory that contains this Mathematica \
notebook. To export to a different directory, simply specify its path \
\[OpenCurlyDoubleQuote]",
 StyleBox["dir",
  FontSlant->"Italic"],
 "\[CloseCurlyDoubleQuote] as ",
 StyleBox["exportformatlab", "Text",
  FontWeight->"Bold",
  FontColor->RGBColor[0, 0, 1]],
 StyleBox["[", "Text",
  FontColor->GrayLevel[0]],
 StyleBox["tag", "Text",
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox[",\[CloseCurlyDoubleQuote]", "Text",
  FontColor->GrayLevel[0]],
 StyleBox["dir", "Text",
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox["\[CloseCurlyDoubleQuote]]. (The path would have a form like \
\[OpenCurlyDoubleQuote]", "Text",
  FontColor->GrayLevel[0]],
 StyleBox["dir", "Text",
  FontSlant->"Italic",
  FontColor->GrayLevel[0]],
 StyleBox["\[CloseCurlyDoubleQuote]=\[CloseCurlyDoubleQuote]C:\\\\ Users \\\\ \
MyName \\\\ Documents \\\\Example\[CloseCurlyDoubleQuote]. The double \
quotation marks are necessary for Mathematica to correctly interpret the \
input.)\n\nIn all the examples considered the process matrix is real and \
numerical. One must pay attention when trying to export complex-valued \
matrices or containing symbolic notation, such as ", "Text",
  FontColor->GrayLevel[0]],
 Cell[BoxData[
  FormBox[
   SqrtBox["2"], TraditionalForm]]],
 ", \[Pi], etc., because MATLAB might not interpret the symbols correctly. \
For complex matrices, one can export the real and the imaginary part of the \
matrix as two real matrices in two separate files; the complex matrix can \
then be reconstructed in MATLAB. For symbolic matrices, it is generally safer \
to convert them to numerical ones before export."
}], "Text",
 CellChangeTimes->{{3.699437831771596*^9, 3.69943788284742*^9}, {
   3.6994379973845563`*^9, 3.6994380219282727`*^9}, {3.6994381089156775`*^9, 
   3.69943814707756*^9}, {3.6994384607845516`*^9, 3.6994385322115164`*^9}, {
   3.6994385659633374`*^9, 3.6994388682908373`*^9}, {3.699474509154004*^9, 
   3.6994745488589225`*^9}, {3.6994772961931725`*^9, 
   3.6994773109736037`*^9}, {3.6994774719180846`*^9, 3.699477676802785*^9}, 
   3.6994805632762723`*^9, {3.699480610184092*^9, 3.699480632064873*^9}, {
   3.7211992461201477`*^9, 3.721199246484182*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.721199605263039*^9, 3.7211996078434*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 "References\n",
 StyleBox["[1] K. \:017byczkowski and H.-J. Sommers, Induced measures in the \
space of mixed quantum states,", "Text",
  FontColor->RGBColor[0., 0., 0.]],
 StyleBox[" J. Phys. A: Math. Gen.", "Text",
  FontSlant->"Italic",
  FontColor->RGBColor[0., 0., 0.]],
 StyleBox[" ", "Text",
  FontColor->RGBColor[0., 0., 0.]],
 StyleBox["34 ", "Text",
  FontWeight->"Bold",
  FontColor->RGBColor[0., 0., 0.]],
 StyleBox["7111 (2001).\n[2] W. Bruzda,V. Cappellini, H.-J. Sommers and K. \
Zyczkowski, Random quantum operations ", "Text",
  FontColor->RGBColor[0., 0., 0.]],
 StyleBox["Phys. Lett. A", "Text",
  FontSlant->"Italic",
  FontColor->RGBColor[0., 0., 0.]],
 StyleBox[" ", "Text",
  FontColor->RGBColor[0., 0., 0.]],
 StyleBox["373", "Text",
  FontWeight->"Bold",
  FontColor->RGBColor[0., 0., 0.]],
 StyleBox[" 320 ( 2009).", "Text",
  FontColor->RGBColor[0., 0., 0.]]
}], "Section",
 CellChangeTimes->{{3.6994356931101303`*^9, 3.6994356960937304`*^9}, {
   3.6994357589712515`*^9, 3.6994358577570877`*^9}, {3.699435938230548*^9, 
   3.6994360183003397`*^9}, {3.6994360552962465`*^9, 3.699436149464294*^9}, {
   3.699436200841737*^9, 3.6994362062108603`*^9}, {3.699436264943055*^9, 
   3.6994364379051795`*^9}, {3.6994373488372793`*^9, 
   3.6994374180826607`*^9}, {3.6994376092653794`*^9, 
   3.6994376154157095`*^9}, {3.6994376762291555`*^9, 3.69943770685384*^9}, {
   3.6994384207880716`*^9, 3.699438421040987*^9}, {3.699477317957529*^9, 
   3.699477319657238*^9}, {3.721199625876688*^9, 3.7211996356764593`*^9}, {
   3.721199715926319*^9, 3.7211998788683157`*^9}, {3.721199966967678*^9, 
   3.7212000498598213`*^9}, 3.7212000838761864`*^9, 3.7212004240953894`*^9, {
   3.72120058230501*^9, 3.72120058272952*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.721199609998935*^9, 3.721199633132227*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1584, 817},
WindowMargins->{{-8, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.0 for Microsoft Windows (64-bit) (September 21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 392, 8, 121, "Title"],
Cell[975, 32, 340, 12, 23, "Author"],
Cell[1318, 46, 585, 14, 71, "Institution"],
Cell[CellGroupData[{
Cell[1928, 64, 1111, 20, 85, "Section"],
Cell[CellGroupData[{
Cell[3064, 88, 634, 14, 37, "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10001.}],
Cell[3701, 104, 24858, 611, 1893, "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10001.}]
}, Closed]],
Cell[CellGroupData[{
Cell[28596, 720, 512, 12, 31, "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[29111, 734, 4603, 116, 278, "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[33717, 852, 24723, 620, 1323, "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[58443, 1474, 25813, 604, 943, "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[84259, 2080, 61517, 1453, 2634, "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}]
}, Closed]],
Cell[CellGroupData[{
Cell[145813, 3538, 371, 9, 31, "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.}],
Cell[146187, 3549, 8524, 205, 449, "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.}],
Cell[154714, 3756, 7518, 164, 468, "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.}]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[162281, 3926, 509, 7, 49, "Section"],
Cell[162793, 3935, 1750, 47, 106, "Text"],
Cell[CellGroupData[{
Cell[164568, 3986, 140, 1, 42, "Subsection"],
Cell[164711, 3989, 7525, 218, 229, "Text"],
Cell[172239, 4209, 861, 24, 50, "Input"],
Cell[173103, 4235, 1492, 46, 51, "Text"],
Cell[174598, 4283, 619, 12, 30, "Input"],
Cell[175220, 4297, 252, 5, 30, "Text"],
Cell[175475, 4304, 389, 8, 69, "Input"],
Cell[175867, 4314, 3634, 72, 180, "Text"],
Cell[179504, 4388, 1334, 43, 69, "Input"],
Cell[180841, 4433, 430, 7, 49, "Text"],
Cell[181274, 4442, 253, 5, 50, "Input"],
Cell[181530, 4449, 562, 16, 30, "Text"],
Cell[182095, 4467, 318, 6, 50, "Input"],
Cell[182416, 4475, 1173, 30, 87, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[183626, 4510, 246, 3, 43, "Subsection"],
Cell[183875, 4515, 2919, 116, 68, "Text"],
Cell[186797, 4633, 467, 8, 107, "Input"],
Cell[187267, 4643, 2545, 70, 106, "Text"],
Cell[189815, 4715, 874, 15, 107, "Input"],
Cell[190692, 4732, 756, 27, 30, "Text"],
Cell[191451, 4761, 659, 12, 88, "Input"],
Cell[192113, 4775, 687, 22, 49, "Text"],
Cell[192803, 4799, 3304, 127, 91, "Text"],
Cell[196110, 4928, 336, 7, 50, "Input"],
Cell[196449, 4937, 772, 27, 49, "Text"],
Cell[197224, 4966, 559, 10, 107, "Input"],
Cell[197786, 4978, 159, 3, 30, "Input"],
Cell[197948, 4983, 555, 12, 49, "Text"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[198552, 5001, 606, 8, 63, "Section"],
Cell[199161, 5011, 2373, 55, 125, "Text"],
Cell[201537, 5068, 140, 2, 30, "Input"],
Cell[201680, 5072, 249, 3, 30, "Text"],
Cell[201932, 5077, 480, 14, 50, "Input"],
Cell[202415, 5093, 124, 1, 30, "Text"],
Cell[202542, 5096, 273, 7, 30, "Input"],
Cell[202818, 5105, 2580, 60, 130, "Text"],
Cell[205401, 5167, 90, 1, 30, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[205528, 5173, 1750, 38, 101, "Section"],
Cell[207281, 5213, 92, 1, 30, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

